# å¾®ä¿¡è‡ªåŠ¨å‘å¸ƒå·¥å…· - å¼€å‘è§„åˆ’

> ç”Ÿæˆæ—¶é—´: 2025-12-04
> æœ€åæ›´æ–°: 2025-12-05 (Phase 7 å®Œæˆ)
> åŸºäº: wechat-prd.md v1.9

---

## å½“å‰è¿›åº¦

| é˜¶æ®µ | çŠ¶æ€ | çº¿ç¨‹æ•° | è¯´æ˜ |
|------|------|--------|------|
| ç¬¬ä¸€é˜¶æ®µ | âœ… å·²å®Œæˆ | 3 | åŸºç¡€æ¡†æ¶ã€æ•°æ®æ¨¡å‹ã€é…ç½®ç³»ç»Ÿ |
| ç¬¬äºŒé˜¶æ®µ | âœ… å·²å®Œæˆ | 4 | æ•°æ®å¯¼å…¥ã€çª—å£æ§åˆ¶ã€ä»»åŠ¡è°ƒåº¦ã€ç³»ç»Ÿå·¥å…· |
| ç¬¬ä¸‰é˜¶æ®µ | âœ… å·²å®Œæˆ | 2 | æœ‹å‹åœˆå‘å¸ƒå™¨ã€ç¾¤å‘æ¶ˆæ¯å™¨ âœ… å·²ä¿®å¤é›†æˆé—®é¢˜ |
| ç¬¬å››é˜¶æ®µ | âœ… å·²å®Œæˆ | 2 | é£æ§æ£€æµ‹ã€ç†”æ–­é‡è¯• âœ… å·²å®¡æ ¸ä¿®å¤ |
| ç¬¬äº”é˜¶æ®µ A/B | âœ… å·²å®Œæˆ | 2 | GUI ä¸»çª—å£ã€é˜Ÿåˆ—ã€å®šæ—¶ã€è®¾ç½® âœ… å·²å®¡æ ¸ä¿®å¤ |
| ç¬¬äº”é˜¶æ®µ C | âœ… å·²å®Œæˆ | 1 | GUI ç»Ÿè®¡ã€é¢„è§ˆã€æ—¥å¿— âœ… å·²å®¡æ ¸ä¿®å¤ |
| ç¬¬å…­é˜¶æ®µ | âœ… å·²å®Œæˆ | 2 | é€šçŸ¥æœåŠ¡ã€ç»Ÿè®¡å›æ‰§ âœ… å·²å®¡æ ¸ä¿®å¤ |
| ç¬¬ä¸ƒé˜¶æ®µ | âœ… å·²å®Œæˆ | 1 | é›†æˆæµ‹è¯• âœ… 269 æµ‹è¯•ç”¨ä¾‹, 252 é€šè¿‡ |

### å·²ä¿®å¤é—®é¢˜ - Phase 5 A/B (7ä¸ª)
1. âœ… rate_limiter.py - å¯¼å…¥é¡ºåºä¿®å¤
2. âœ… moment_sender.py - å±æ€§å‘½åç»Ÿä¸€ (self._xxx)
3. âœ… schedule_tab.py - æ‰¹é‡æ“ä½œäº‹åŠ¡ä¿æŠ¤
4. âœ… queue_tab.py - ç­›é€‰åŠŸèƒ½å®ç° (TaskFilterProxyModel)
5. âœ… main_window.py - Excel å¯¼å…¥åŠŸèƒ½å®ç°
6. âœ… popup_detector.py - é›†æˆ element_locator
7. âœ… settings_tab.py - ç§æœ‰å±æ€§è®¿é—®ä¿®å¤ (æ–°å¢ is_value_encrypted)

### å·²ä¿®å¤é—®é¢˜ - Phase 5-C + 6 é«˜ä¼˜å…ˆçº§ (12ä¸ª)
1. âœ… preview_dialog.py - content.images â†’ content.image_paths
2. âœ… stats_tab.py - stat_date ç±»å‹è½¬æ¢ (strftime)
3. âœ… stats_tab.py - matplotlib å†…å­˜æ³„æ¼ (closeEvent)
4. âœ… log_panel.py - MAX_LINES å¢åŠ åˆ° 10000
5. âœ… log_panel.py - åˆ·æ–°æ€§èƒ½ä¼˜åŒ– (setUpdatesEnabled)
6. âœ… email_notifier.py - Tuple ç±»å‹æ³¨è§£å…¼å®¹æ€§
7. âœ… email_notifier.py - smtp.quit() ä¿æŠ¤
8. âœ… notification_manager.py - queue æ­»é”ä¿®å¤ (finally)
9. âœ… notification_manager.py - task ç«æ€æ¡ä»¶ (deepcopy)
10. âœ… stats_service.py - ä½¿ç”¨ TimeService
11. âœ… stats_service.py - SQL DATE() å…¼å®¹æ€§ (å·²éªŒè¯)
12. âœ… receipt_generator.py - TimeService æ ¼å¼åŒ–

### å·²ä¿®å¤é—®é¢˜ - Phase 5-C + 6 ä¸­ä¼˜å…ˆçº§ (8ä¸ª)
1. âœ… stats_tab.py - filter_stats æ—¥æœŸæ¯”è¾ƒç±»å‹ä¿®å¤
2. âœ… stats_tab.py - CSV å¯¼å‡ºæ—¥æœŸæ ¼å¼åŒ–
3. âœ… preview_dialog.py - Channel.MOMENT â†’ Channel.moment
4. âœ… receipt_generator.py - executed_at â†’ executed_time
5. âœ… notification_manager.py - notify_success å·²å®‰å…¨
6. âœ… email_notifier.py - å¼‚æ­¥å‘é€æ—¥å¿—å›è°ƒ
7. âœ… log_panel.py - TimeService ä¸éœ€è¦ä¿®æ”¹ (GUIæœ¬åœ°æ—¶é—´åˆé€‚)
8. âœ… stats_tab.py - StatsTab closeEvent èµ„æºæ¸…ç†

**Phase 7 æµ‹è¯•å®Œæˆ** âœ…
- æµ‹è¯•ç”¨ä¾‹: 269 ä¸ª
- é€šè¿‡: 252 ä¸ª (93.7%)
- å¤±è´¥: 6 ä¸ª (è¾¹ç¼˜æƒ…å†µ)
- è·³è¿‡: 11 ä¸ª (E2E éœ€è¦çœŸå®å¾®ä¿¡)
- è¦†ç›–ç‡: models 100%, database 92%, queue_manager 91%

**ä¸‹ä¸€æ­¥** â†’ é¡¹ç›®å·²åŸºæœ¬å®Œæˆï¼Œå¯è¿›è¡Œç³»ç»Ÿæµ‹è¯•å’Œéƒ¨ç½²

---

## ä¸€ã€é¡¹ç›®æ¦‚è¿°

å¼€å‘ä¸€æ¬¾ PC ç«¯å¾®ä¿¡è‡ªåŠ¨å‘å¸ƒå·¥å…·ï¼Œå®ç°ï¼š
- è‡ªåŠ¨å‘å¸ƒæœ‹å‹åœˆ (å›¾æ–‡/çº¯æ–‡å­—)
- è‡ªåŠ¨ç¾¤å‘æ¶ˆæ¯åˆ°å¤šä¸ªå¾®ä¿¡ç¾¤
- æ”¯æŒå®šæ—¶å‘å¸ƒã€è‡ªå®šä¹‰é¡ºåº
- æä¾›çŠ¶æ€è¿½è¸ªã€é‚®ä»¶é€šçŸ¥ã€æ•°æ®ç»Ÿè®¡

**æŠ€æœ¯æ ˆï¼š** Python + PySide6 + SQLite + uiautomation

---

## äºŒã€å¼€å‘é˜¶æ®µåˆ’åˆ†

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         å¾®ä¿¡è‡ªåŠ¨å‘å¸ƒå·¥å…· - å¼€å‘é˜¶æ®µ                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  ã€ç¬¬ä¸€é˜¶æ®µã€‘åŸºç¡€æ¡†æ¶æ­å»º (å¯å¹¶è¡Œ 3 ä¸ªçº¿ç¨‹)                                    â”‚
â”‚  â”œâ”€â”€ çº¿ç¨‹A: models/ + data/database.py (æ•°æ®å±‚åŸºç¡€)                         â”‚
â”‚  â”œâ”€â”€ çº¿ç¨‹B: config.yaml + selectors.yaml + config_manager.py (é…ç½®ç³»ç»Ÿ)     â”‚
â”‚  â””â”€â”€ çº¿ç¨‹C: é¡¹ç›®éª¨æ¶ + main.py + requirements.txt (é¡¹ç›®åˆå§‹åŒ–)               â”‚
â”‚                                                                             â”‚
â”‚  ã€ç¬¬äºŒé˜¶æ®µã€‘æ ¸å¿ƒåŠŸèƒ½å¼€å‘ (å¯å¹¶è¡Œ 4 ä¸ªçº¿ç¨‹)                                    â”‚
â”‚  â”œâ”€â”€ çº¿ç¨‹A: data/excel_parser.py + path_mapper.py + image_loader.py        â”‚
â”‚  â”œâ”€â”€ çº¿ç¨‹B: core/wechat_controller.py + element_locator.py                 â”‚
â”‚  â”œâ”€â”€ çº¿ç¨‹C: scheduler/queue_manager.py + task_scheduler.py                 â”‚
â”‚  â””â”€â”€ çº¿ç¨‹D: core/clipboard_manager.py + env_checker.py                     â”‚
â”‚                                                                             â”‚
â”‚  ã€ç¬¬ä¸‰é˜¶æ®µã€‘å‘å¸ƒæ‰§è¡Œå™¨ (å¯å¹¶è¡Œ 2 ä¸ªçº¿ç¨‹)                                      â”‚
â”‚  â”œâ”€â”€ çº¿ç¨‹A: core/moment_sender.py (æœ‹å‹åœˆå‘å¸ƒå™¨)                             â”‚
â”‚  â””â”€â”€ çº¿ç¨‹B: core/group_sender.py (ç¾¤å‘æ¶ˆæ¯å™¨)                                â”‚
â”‚                                                                             â”‚
â”‚  ã€ç¬¬å››é˜¶æ®µã€‘å®‰å…¨ä¸ä¿æŠ¤ (å¯å¹¶è¡Œ 2 ä¸ªçº¿ç¨‹)                                      â”‚
â”‚  â”œâ”€â”€ çº¿ç¨‹A: core/popup_detector.py + risk_control.py + shutdown_controller â”‚
â”‚  â””â”€â”€ çº¿ç¨‹B: scheduler/circuit_breaker.py + retry_handler.py                â”‚
â”‚                                                                             â”‚
â”‚  ã€ç¬¬äº”é˜¶æ®µã€‘GUI ç•Œé¢ (å¯å¹¶è¡Œ 3 ä¸ªçº¿ç¨‹)                                        â”‚
â”‚  â”œâ”€â”€ çº¿ç¨‹A: gui/main_window.py + queue_tab.py                               â”‚
â”‚  â”œâ”€â”€ çº¿ç¨‹B: gui/schedule_tab.py + settings_tab.py                           â”‚
â”‚  â””â”€â”€ çº¿ç¨‹C: gui/stats_tab.py + preview_dialog.py + log_panel.py            â”‚
â”‚                                                                             â”‚
â”‚  ã€ç¬¬å…­é˜¶æ®µã€‘é€šçŸ¥ä¸æœåŠ¡ (å¯å¹¶è¡Œ 2 ä¸ªçº¿ç¨‹)                                      â”‚
â”‚  â”œâ”€â”€ çº¿ç¨‹A: services/email_notifier.py + notification_manager.py           â”‚
â”‚  â””â”€â”€ çº¿ç¨‹B: services/stats_service.py + data/receipt_generator.py          â”‚
â”‚                                                                             â”‚
â”‚  ã€ç¬¬ä¸ƒé˜¶æ®µã€‘é›†æˆæµ‹è¯•ä¸ä¼˜åŒ–                                                   â”‚
â”‚  â””â”€â”€ çº¿ç¨‹A: ç«¯åˆ°ç«¯æµ‹è¯• + æ€§èƒ½ä¼˜åŒ– + æ–‡æ¡£                                      â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ä¸‰ã€æ¨¡å—ä¾èµ–å…³ç³»å›¾

```
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚   main.py   â”‚
                              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â–¼                â–¼                â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚   gui/  â”‚      â”‚services/â”‚      â”‚schedulerâ”‚
              â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
                   â”‚                â”‚                â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â–¼                 â–¼      â–¼      â–¼                   â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚queue_tab â”‚      â”‚stats_tab â”‚   â”‚notification â”‚   â”‚queue_mgr  â”‚
    â”‚schedule  â”‚      â”‚settings  â”‚   â”‚email/voice  â”‚   â”‚scheduler  â”‚
    â”‚preview   â”‚      â”‚log_panel â”‚   â”‚stats_svc    â”‚   â”‚circuit_brkâ”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
         â”‚                 â”‚                â”‚                â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚   core/   â”‚  â—„â”€â”€â”€ æ‰§è¡Œå™¨å±‚ (æ ¸å¿ƒ)
            â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
                  â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â–¼             â–¼             â–¼             â–¼             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚wechat_ â”‚  â”‚moment_   â”‚  â”‚group_    â”‚  â”‚popup_    â”‚  â”‚clipboard â”‚
â”‚control â”‚  â”‚sender    â”‚  â”‚sender    â”‚  â”‚detector  â”‚  â”‚manager   â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚           â”‚             â”‚             â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚   data/   â”‚  â—„â”€â”€â”€ æ•°æ®å±‚
         â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
               â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â–¼          â–¼          â–¼          â–¼          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚databaseâ”‚â”‚excel_  â”‚â”‚path_   â”‚â”‚image_  â”‚â”‚receipt â”‚
â”‚        â”‚â”‚parser  â”‚â”‚mapper  â”‚â”‚loader  â”‚â”‚generat â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  models/  â”‚  â—„â”€â”€â”€ æ¨¡å‹å±‚ (æœ€åº•å±‚ï¼Œæ— ä¾èµ–)
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ enums.py  â”‚
â”‚ task.py   â”‚
â”‚ content.pyâ”‚
â”‚ stats.py  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## å››ã€å¹¶è¡Œå¼€å‘ç­–ç•¥

### å¼€å‘é¡ºåºä¸ä¾èµ–

```
é˜¶æ®µ1 (åŸºç¡€) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º
     â”‚
     â”‚  â”Œâ”€ çº¿ç¨‹1-A: models/ + database â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”œâ”€â”€â”¼â”€ çº¿ç¨‹1-B: config + selectors â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€ å¯å®Œå…¨å¹¶è¡Œ
     â”‚  â””â”€ çº¿ç¨‹1-C: é¡¹ç›®éª¨æ¶ + main.py â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼  ç­‰å¾…é˜¶æ®µ1å®Œæˆ
é˜¶æ®µ2 (æ ¸å¿ƒ) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º
     â”‚
     â”‚  â”Œâ”€ çº¿ç¨‹2-A: excel_parser + image_loader â”€â”€â”€â”€â”
     â”œâ”€â”€â”¼â”€ çº¿ç¨‹2-B: wechat_controller + locator â”€â”€â”€â”€â”¼â”€â”€ å¯å®Œå…¨å¹¶è¡Œ
     â”‚  â”œâ”€ çº¿ç¨‹2-C: queue_manager + scheduler â”€â”€â”€â”€â”€â”€â”¤
     â”‚  â””â”€ çº¿ç¨‹2-D: clipboard + env_checker â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼  ç­‰å¾…é˜¶æ®µ2å®Œæˆ
é˜¶æ®µ3 (æ‰§è¡Œå™¨) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º
     â”‚
     â”‚  â”Œâ”€ çº¿ç¨‹3-A: moment_sender â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”œâ”€â”€â”¤                                            â”œâ”€â”€ å¯å¹¶è¡Œ (å…±äº« wechat_controller)
     â”‚  â””â”€ çº¿ç¨‹3-B: group_sender â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼  ç­‰å¾…é˜¶æ®µ3å®Œæˆ
é˜¶æ®µ4 (å®‰å…¨) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º
     â”‚
     â”‚  â”Œâ”€ çº¿ç¨‹4-A: risk_detector + shutdown â”€â”€â”€â”€â”€â”€â”€â”
     â”œâ”€â”€â”¤                                            â”œâ”€â”€ å¯å¹¶è¡Œ
     â”‚  â””â”€ çº¿ç¨‹4-B: circuit_breaker + retry â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼  ç­‰å¾…é˜¶æ®µ4å®Œæˆ
é˜¶æ®µ5 (GUI) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º
     â”‚
     â”‚  â”Œâ”€ çº¿ç¨‹5-A: main_window + queue_tab â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”œâ”€â”€â”¼â”€ çº¿ç¨‹5-B: schedule_tab + settings_tab â”€â”€â”€â”€â”¼â”€â”€ å¯å¹¶è¡Œ
     â”‚  â””â”€ çº¿ç¨‹5-C: stats_tab + preview + log â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼  ç­‰å¾…é˜¶æ®µ5å®Œæˆ
é˜¶æ®µ6 (æœåŠ¡) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º
     â”‚
     â”‚  â”Œâ”€ çº¿ç¨‹6-A: email + notification â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”œâ”€â”€â”¤                                            â”œâ”€â”€ å¯å¹¶è¡Œ
     â”‚  â””â”€ çº¿ç¨‹6-B: stats_service + receipt â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
é˜¶æ®µ7 (é›†æˆæµ‹è¯•)
```

### æ¨èå·¥ä½œæµ

```
ä½  (æ€»æŒ‡æŒ¥)
    â”‚
    â”œâ”€â”€ Claude ä¼šè¯1 â”€â”€â”€ çº¿ç¨‹1-A
    â”œâ”€â”€ Claude ä¼šè¯2 â”€â”€â”€ çº¿ç¨‹1-B
    â””â”€â”€ Claude ä¼šè¯3 â”€â”€â”€ çº¿ç¨‹1-C
              â”‚
              â–¼ æ”¶é›†ä»£ç ï¼Œé›†æˆæµ‹è¯•
              â”‚
    â”œâ”€â”€ Claude ä¼šè¯4 â”€â”€â”€ çº¿ç¨‹2-A
    â”œâ”€â”€ Claude ä¼šè¯5 â”€â”€â”€ çº¿ç¨‹2-B
    ...
```

---

## äº”ã€å¼€å‘æç¤ºè¯

---

### ç¬¬ä¸€é˜¶æ®µï¼šåŸºç¡€æ¡†æ¶ (3ä¸ªå¹¶è¡Œçº¿ç¨‹) - âœ… å·²å®Œæˆ

> **çŠ¶æ€**: å·²å®Œæˆ (2025-12-04)
> **å®¡æ ¸è¯„åˆ†**: 8.4/10
>
> å·²å®Œæˆæ¨¡å—:
> - models/ (enums.py, task.py, content.py, stats.py)
> - data/database.py
> - services/config_manager.py
> - config.yaml, selectors.yaml
> - main.py, requirements.txt
>
> å·²ä¿®å¤é—®é¢˜:
> - âœ… requirements.txt æ·»åŠ  watchdog ä¾èµ–
> - âœ… main.py åˆ†è¾¨ç‡æ£€æŸ¥ä»é…ç½®è¯»å–
> - âœ… main.py æ—¥å¿—é…ç½®ä»é…ç½®è¯»å–
> - âœ… æ·»åŠ  .gitignore å¿½ç•¥æ•æ„Ÿæ–‡ä»¶

<details>
<summary>ç‚¹å‡»å±•å¼€ç¬¬ä¸€é˜¶æ®µæç¤ºè¯ (å·²å®Œæˆ)</summary>

### çº¿ç¨‹ 1-A: æ•°æ®æ¨¡å‹å±‚

```
# è§’è‰²
ä½ æ˜¯ä¸€ä¸ª Python å¼€å‘ä¸“å®¶ï¼Œè´Ÿè´£å®ç°å¾®ä¿¡è‡ªåŠ¨å‘å¸ƒå·¥å…·çš„æ•°æ®æ¨¡å‹å±‚ã€‚

# é¡¹ç›®èƒŒæ™¯
å¼€å‘ä¸€ä¸ª PC ç«¯å¾®ä¿¡è‡ªåŠ¨å‘å¸ƒå·¥å…·ï¼Œä½¿ç”¨ Python + PySide6 + SQLite æŠ€æœ¯æ ˆã€‚

# ä½ çš„ä»»åŠ¡
å¼€å‘ models/ ç›®å½•ä¸‹çš„æ‰€æœ‰æ•°æ®æ¨¡å‹å’Œ data/database.py æ•°æ®åº“æ“ä½œæ¨¡å—ã€‚

# éœ€è¦åˆ›å»ºçš„æ–‡ä»¶

## 1. models/enums.py
å®šä¹‰ä»¥ä¸‹æšä¸¾ï¼š
- TaskStatus: pending/scheduled/running/success/failed/skipped/cancelled/paused
- Channel: moment(æœ‹å‹åœˆ)/group(ç¾¤å‘)
- RiskLevel: low/medium/high/critical
- CircuitState: closed/open/half_open

## 2. models/task.py
ä»»åŠ¡æ¨¡å‹ï¼ŒåŒ…å«å­—æ®µï¼š
- id, content_code, product_name, channel, group_name
- status, scheduled_time, priority, retry_count, max_retry
- executed_time, error_message, screenshot_path
- failure_reason, pause_reason, note
- created_at, updated_at

## 3. models/content.py
å†…å®¹æ¨¡å‹ï¼ŒåŒ…å«å­—æ®µï¼š
- content_code, text, image_paths (åˆ—è¡¨), channel

## 4. models/stats.py
ç»Ÿè®¡æ¨¡å‹ï¼Œç”¨äºæ—¥æŠ¥/å‘¨æŠ¥èšåˆ

## 5. data/database.py
SQLite æ•°æ®åº“æ“ä½œï¼š
- ä½¿ç”¨ WAL æ¨¡å¼
- å®ç° CRUD æ“ä½œ
- å®ç°ä»»åŠ¡è¡¨å’Œå¹‚ç­‰é”®è¡¨
- ä½¿ç”¨ä¸Šä¸‹æ–‡ç®¡ç†å™¨å¤„ç†è¿æ¥

# å…³é”®çº¦æŸ
1. çŠ¶æ€æšä¸¾å¿…é¡»ä¸¥æ ¼éµå¾ªè§„èŒƒï¼Œç¦æ­¢åˆ«å
2. ä»»åŠ¡è¡¨éœ€è¦ UNIQUE çº¦æŸï¼š(content_code, channel, group_name, scheduled_date)
3. scheduled_date ä½¿ç”¨ GENERATED ALWAYS AS (DATE(scheduled_time)) STORED
4. æ‰€æœ‰æ—¶é—´ä½¿ç”¨ Asia/Shanghai æ—¶åŒº

# è¾“å‡ºè¦æ±‚
- å®Œæ•´å¯è¿è¡Œçš„ Python ä»£ç 
- åŒ…å«ç±»å‹æ³¨è§£
- åŒ…å«ç®€æ´çš„æ–‡æ¡£å­—ç¬¦ä¸²
```

---

### çº¿ç¨‹ 1-B: é…ç½®ç³»ç»Ÿ

```
# è§’è‰²
ä½ æ˜¯ä¸€ä¸ª Python é…ç½®ç®¡ç†ä¸“å®¶ï¼Œè´Ÿè´£å®ç°é…ç½®ç³»ç»Ÿã€‚

# é¡¹ç›®èƒŒæ™¯
å¾®ä¿¡è‡ªåŠ¨å‘å¸ƒå·¥å…·éœ€è¦ä¸€ä¸ªçµæ´»çš„é…ç½®ç³»ç»Ÿï¼Œæ”¯æŒ YAML é…ç½®å’Œçƒ­æ›´æ–°ã€‚

# ä½ çš„ä»»åŠ¡
å¼€å‘é…ç½®ç³»ç»Ÿç›¸å…³æ–‡ä»¶ã€‚

# éœ€è¦åˆ›å»ºçš„æ–‡ä»¶

## 1. config.yaml
ä¸»é…ç½®æ–‡ä»¶ï¼ŒåŒ…å«ï¼š
- paths: shared_folder, cache_dir, receipts_dir, logs_dir
- schedule: default_interval(180s), random_delay(0-60s), daily_limit
- email: smtpé…ç½®, æ”¶ä»¶äºº
- circuit_breaker: failure_threshold(3), recovery_timeout(300s)
- resend: auto_resend_missed, max_retry_count
- display: min_resolution, primary_monitor_only
- image_processing: auto_compress, compress_quality

## 2. selectors.yaml
å¾®ä¿¡ UI é€‰æ‹©å™¨é…ç½®ï¼ŒæŒ‰å¾®ä¿¡ç‰ˆæœ¬åˆ†ç»„ï¼š
- v3.9.10, v3.9.11 ç­‰ç‰ˆæœ¬
- æ¯ä¸ªç‰ˆæœ¬åŒ…å«ï¼šä¸»çª—å£ã€å‘ç°æŒ‰é’®ã€æœ‹å‹åœˆå…¥å£ã€å‘å¸ƒæŒ‰é’®ç­‰é€‰æ‹©å™¨
- é€‰æ‹©å™¨æ ¼å¼ï¼šAutomationId/Name/ClassName/ControlType ç»„åˆ

## 3. services/config_manager.py
é…ç½®ç®¡ç†å™¨ï¼š
- åŠ è½½ YAML é…ç½®
- æ”¯æŒé…ç½®éªŒè¯
- æ•æ„Ÿä¿¡æ¯åŠ å¯†å­˜å‚¨ (é‚®ç®±å¯†ç ç­‰)
- é…ç½®çƒ­æ›´æ–°ç›‘å¬

# å…³é”®çº¦æŸ
1. é…ç½®å¿…é¡»æœ‰é»˜è®¤å€¼
2. æ•æ„Ÿä¿¡æ¯ä½¿ç”¨ cryptography åº“åŠ å¯†
3. é…ç½®å˜æ›´éœ€è®°å½•æ—¥å¿—
4. é€‰æ‹©å™¨æ”¯æŒçƒ­æ›´æ–°ï¼Œä¸éœ€é‡å¯

# è¾“å‡ºè¦æ±‚
- config.yaml å®Œæ•´é…ç½®æ¨¡æ¿
- selectors.yaml UI é€‰æ‹©å™¨æ¨¡æ¿
- config_manager.py å®Œæ•´å®ç°
```

---

### çº¿ç¨‹ 1-C: é¡¹ç›®éª¨æ¶

```
# è§’è‰²
ä½ æ˜¯ä¸€ä¸ª Python é¡¹ç›®æ¶æ„å¸ˆï¼Œè´Ÿè´£æ­å»ºé¡¹ç›®éª¨æ¶ã€‚

# é¡¹ç›®èƒŒæ™¯
å¾®ä¿¡è‡ªåŠ¨å‘å¸ƒå·¥å…·çš„é¡¹ç›®åˆå§‹åŒ–å’Œå…¥å£æ–‡ä»¶ã€‚

# ä½ çš„ä»»åŠ¡
åˆ›å»ºé¡¹ç›®ç›®å½•ç»“æ„å’Œå…¥å£æ–‡ä»¶ã€‚

# éœ€è¦åˆ›å»ºçš„æ–‡ä»¶

## 1. ç›®å½•ç»“æ„
wechat-auto-sender/
â”œâ”€â”€ main.py
â”œâ”€â”€ config.yaml
â”œâ”€â”€ selectors.yaml
â”œâ”€â”€ requirements.txt
â”œâ”€â”€ gui/
â”‚   â””â”€â”€ __init__.py
â”œâ”€â”€ core/
â”‚   â””â”€â”€ __init__.py
â”œâ”€â”€ data/
â”‚   â””â”€â”€ __init__.py
â”œâ”€â”€ scheduler/
â”‚   â””â”€â”€ __init__.py
â”œâ”€â”€ models/
â”‚   â””â”€â”€ __init__.py
â”œâ”€â”€ services/
â”‚   â””â”€â”€ __init__.py
â”œâ”€â”€ templates/
â”œâ”€â”€ logs/
â”œâ”€â”€ cache/
â”œâ”€â”€ receipts/
â””â”€â”€ db/

## 2. main.py
ç¨‹åºå…¥å£ï¼š
- å¯åŠ¨å‰æ£€æŸ¥åœæœºæ ‡è®°æ–‡ä»¶
- åˆå§‹åŒ–æ—¥å¿—ç³»ç»Ÿ (æŒ‰å¤©è½®è½¬)
- åŠ è½½é…ç½®
- ç¯å¢ƒè‡ªæ£€ (å¾®ä¿¡ç™»å½•ã€å…±äº«æ–‡ä»¶å¤¹ã€åˆ†è¾¨ç‡)
- å¯åŠ¨ PySide6 GUI
- ä¼˜é›…é€€å‡ºå¤„ç†

## 3. requirements.txt
ä¾èµ–æ¸…å•ï¼š
- PySide6 (GUI)
- uiautomation (UI è‡ªåŠ¨åŒ–)
- pywinauto (çª—å£æ§åˆ¶)
- PyAutoGUI (é¼ æ ‡é”®ç›˜)
- openpyxl (Excel)
- Pillow (å›¾ç‰‡)
- APScheduler (å®šæ—¶ä»»åŠ¡)
- pyyaml (é…ç½®)
- pyperclip (å‰ªè´´æ¿)
- pywin32 (Windows API)
- cryptography (åŠ å¯†)
- pytesseract (OCR, å¯é€‰)

# è¾“å‡ºè¦æ±‚
- å®Œæ•´çš„ main.py å…¥å£æ–‡ä»¶
- requirements.txt ä¾èµ–æ¸…å•
- å„æ¨¡å—çš„ __init__.py
```

</details>

---

### ç¬¬äºŒé˜¶æ®µï¼šæ ¸å¿ƒåŠŸèƒ½ (4ä¸ªå¹¶è¡Œçº¿ç¨‹) - âœ… å·²å®Œæˆ

> **çŠ¶æ€**: å·²å®Œæˆ (2025-12-04)
> **å®¡æ ¸è¯„åˆ†**: 8.5/10
>
> å·²å®Œæˆæ¨¡å—:
> - data/excel_parser.py (95/100)
> - data/path_mapper.py (93/100)
> - data/image_loader.py (96/100)
> - data/image_validator.py (97/100)
> - core/wechat_controller.py (8.5/10)
> - core/element_locator.py (8.0/10)
> - core/clipboard_manager.py (9.0/10)
> - core/env_checker.py (8.5/10)
> - core/display_manager.py (9.0/10)
> - scheduler/queue_manager.py
> - scheduler/task_scheduler.py
> - scheduler/idempotency_manager.py
>
> å·²ä¿®å¤é—®é¢˜:
> - âœ… scheduler/ æ¨¡å—ä½ç½®ä¿®æ­£ (ä» wechat-auto-sender/scheduler/ å¤åˆ¶åˆ°æ ¹ç›®å½• scheduler/)

| çº¿ç¨‹ | æ¨¡å— | è¯´æ˜ |
|------|------|------|
| 2-A | excel_parser, path_mapper, image_loader, image_validator | æ•°æ®å¯¼å…¥ |
| 2-B | wechat_controller, element_locator | å¾®ä¿¡çª—å£æ§åˆ¶ |
| 2-C | queue_manager, task_scheduler, idempotency_manager | ä»»åŠ¡è°ƒåº¦ |
| 2-D | clipboard_manager, env_checker, display_manager | ç³»ç»Ÿå·¥å…· |

<details>
<summary>ç‚¹å‡»å±•å¼€ç¬¬äºŒé˜¶æ®µæç¤ºè¯ (å·²å®Œæˆ)</summary>

---

### çº¿ç¨‹ 2-A: æ•°æ®å¯¼å…¥æ¨¡å—

```
# è§’è‰²
ä½ æ˜¯ä¸€ä¸ª Python æ•°æ®å¤„ç†ä¸“å®¶ï¼Œè´Ÿè´£å®ç° Excel è§£æå’Œå›¾ç‰‡åŠ è½½æ¨¡å—ã€‚

# é¡¹ç›®èƒŒæ™¯
å¾®ä¿¡è‡ªåŠ¨å‘å¸ƒå·¥å…·ï¼ŒæŠ€æœ¯æ ˆï¼šPython + PySide6 + SQLite + uiautomation

# å·²å®Œæˆæ¨¡å— (ç¬¬ä¸€é˜¶æ®µ)
- models/enums.py: TaskStatus, Channel æšä¸¾
- models/task.py: Task æ•°æ®ç±»
- models/content.py: Content æ•°æ®ç±»
- data/database.py: SQLite æ•°æ®åº“æ“ä½œ
- services/config_manager.py: é…ç½®ç®¡ç†

# ä½ çš„ä»»åŠ¡
å¼€å‘ data/ ç›®å½•ä¸‹çš„æ•°æ®å¯¼å…¥ç›¸å…³æ¨¡å—ã€‚

# éœ€è¦åˆ›å»ºçš„æ–‡ä»¶

## 1. data/excel_parser.py
Excel è§£æå™¨ï¼š
- è¯»å–å‘å¸ƒæ¸…å• xlsx æ–‡ä»¶
- å¿…éœ€åˆ—ï¼šäº§å“ç¼–ç (content_code)ã€å‘å¸ƒæ¸ é“(channel)ã€æ’æœŸæ—¶é—´(scheduled_time)
- å¯é€‰åˆ—ï¼šäº§å“åç§°(product_name)ã€æ–‡æ¡ˆå†…å®¹(text)ã€å›¾ç‰‡è·¯å¾„(image_paths)ã€ç¾¤å(group_name)
- æ•°æ®æ ¡éªŒï¼šæ¸ é“å€¼éªŒè¯(moment/group)ã€æ—¶é—´æ ¼å¼éªŒè¯ã€è·¯å¾„å­˜åœ¨æ€§
- è¿”å›æ ¡éªŒç»“æœå’Œè§£æåçš„ä»»åŠ¡åˆ—è¡¨
- ä½¿ç”¨ models.task.Task å’Œ models.content.Content æ•°æ®ç±»

## 2. data/path_mapper.py
è·¯å¾„æ˜ å°„å™¨ï¼š
- å…±äº«æ–‡ä»¶å¤¹è·¯å¾„ <-> æœ¬åœ°ç¼“å­˜è·¯å¾„è½¬æ¢
- æ”¯æŒé…ç½®çš„å…±äº«æ–‡ä»¶å¤¹æ ¹ç›®å½• (å¦‚ Z:\publish)
- å›¾ç‰‡è·¯å¾„è§„èŒƒåŒ–å¤„ç†

## 3. data/image_loader.py
å›¾ç‰‡åŠ è½½å™¨ï¼š
- ä»å…±äº«æ–‡ä»¶å¤¹å¤åˆ¶å›¾ç‰‡åˆ°æœ¬åœ°ç¼“å­˜
- å›¾ç‰‡æ ¡éªŒ (å¤§å°ã€æ ¼å¼ã€å°ºå¯¸)
- è¶…é™å›¾ç‰‡è‡ªåŠ¨å‹ç¼© (>10MB)
- MD5 ç¼“å­˜é¿å…é‡å¤å¤„ç†
- GIF æå–ç¬¬ä¸€å¸§

## 4. data/image_validator.py
å›¾ç‰‡æ ¡éªŒå™¨ï¼š
- æœ€å¤§ 9 å¼  (æœ‹å‹åœˆé™åˆ¶)
- å•å¼  <= 10MB
- æ”¯æŒæ ¼å¼ï¼šJPG/PNG/GIF/BMP/WEBP
- æœ€å°å°ºå¯¸ 200x200

# å…³é”®çº¦æŸ
1. Excel ç¼–ç ç»Ÿä¸€ UTF-8
2. å›¾ç‰‡ä½¿ç”¨ MD5 ä½œä¸ºç¼“å­˜é”®
3. å‹ç¼©ä½¿ç”¨ Pillowï¼Œè´¨é‡ä» 95 é€’å‡

# è¾“å‡ºè¦æ±‚
- å®Œæ•´å®ç°çš„ 4 ä¸ªæ¨¡å—
- åŒ…å«é”™è¯¯å¤„ç†å’Œæ—¥å¿—
```

---

### çº¿ç¨‹ 2-B: å¾®ä¿¡çª—å£æ§åˆ¶

```
# è§’è‰²
ä½ æ˜¯ä¸€ä¸ª Windows UI è‡ªåŠ¨åŒ–ä¸“å®¶ï¼Œè´Ÿè´£å¾®ä¿¡çª—å£æ§åˆ¶æ¨¡å—ã€‚

# é¡¹ç›®èƒŒæ™¯
å¾®ä¿¡è‡ªåŠ¨å‘å¸ƒå·¥å…·ï¼ŒæŠ€æœ¯æ ˆï¼šPython + PySide6 + SQLite + uiautomation

# å·²å®Œæˆæ¨¡å— (ç¬¬ä¸€é˜¶æ®µ)
- selectors.yaml: å¾®ä¿¡UIé€‰æ‹©å™¨é…ç½® (æ”¯æŒv3.9.8-v3.9.11)
- services/config_manager.py: é…ç½®ç®¡ç†ï¼Œå¯åŠ è½½selectors
- config.yaml: automation.wechat_version é…ç½®å½“å‰å¾®ä¿¡ç‰ˆæœ¬

# ä½ çš„ä»»åŠ¡
å¼€å‘ core/ ç›®å½•ä¸‹çš„å¾®ä¿¡çª—å£æ§åˆ¶ç›¸å…³æ¨¡å—ã€‚

# éœ€è¦åˆ›å»ºçš„æ–‡ä»¶

## 1. core/wechat_controller.py
å¾®ä¿¡çª—å£æ§åˆ¶å™¨ï¼š
- æŸ¥æ‰¾å¾®ä¿¡ä¸»çª—å£ (ClassName="WeChatMainWndForPC")
- æ¿€æ´»çª—å£åˆ°å‰å°
- çª—å£ä½ç½®/å¤§å°è°ƒæ•´
- æ£€æµ‹å¾®ä¿¡ç™»å½•çŠ¶æ€
- ä½¿ç”¨ uiautomation åº“

æ ¸å¿ƒæ–¹æ³•ï¼š
- find_wechat_window() -> çª—å£å¥æŸ„
- activate_window() -> bool
- check_login_status() -> bool
- get_window_rect() -> Rect
- move_window_to_primary() -> bool

## 2. core/element_locator.py
å…ƒç´ å®šä½å™¨ï¼š
- è¯»å– selectors.yaml é…ç½®
- æŒ‰å¾®ä¿¡ç‰ˆæœ¬åŒ¹é…é€‰æ‹©å™¨
- æ”¯æŒå¤šç§å®šä½æ–¹å¼ï¼šAutomationId, Name, ClassName, ControlType
- å…ƒç´ ç­‰å¾…å’Œè¶…æ—¶å¤„ç†
- è‡ªåŠ¨æ£€æµ‹å½“å‰å¾®ä¿¡ç‰ˆæœ¬

æ ¸å¿ƒæ–¹æ³•ï¼š
- load_selectors(version: str)
- find_element(selector_name: str, timeout: int) -> Control
- wait_for_element(selector_name: str, timeout: int) -> bool
- detect_wechat_version() -> str

# å…³é”®çº¦æŸ
1. æ‰€æœ‰æ“ä½œéœ€è¦è¶…æ—¶æ§åˆ¶ (é»˜è®¤ 10 ç§’)
2. å…ƒç´ å®šä½å¤±è´¥éœ€è¦æˆªå›¾ä¿å­˜
3. æ”¯æŒé€‰æ‹©å™¨çƒ­æ›´æ–°
4. ä½¿ç”¨ uiautomation è€Œé pywinauto å®šä½ (æ›´ç¨³å®š)

# è¾“å‡ºè¦æ±‚
- å®Œæ•´å®ç°çš„æ¨¡å—
- ä½¿ç”¨ uiautomation åº“çš„æ­£ç¡® API
```

---

### çº¿ç¨‹ 2-C: ä»»åŠ¡è°ƒåº¦å™¨

```
# è§’è‰²
ä½ æ˜¯ä¸€ä¸ªä»»åŠ¡è°ƒåº¦ä¸“å®¶ï¼Œè´Ÿè´£å®ç°ä»»åŠ¡é˜Ÿåˆ—å’Œè°ƒåº¦ç³»ç»Ÿã€‚

# é¡¹ç›®èƒŒæ™¯
å¾®ä¿¡è‡ªåŠ¨å‘å¸ƒå·¥å…·ï¼ŒæŠ€æœ¯æ ˆï¼šPython + PySide6 + SQLite + uiautomation

# å·²å®Œæˆæ¨¡å— (ç¬¬ä¸€é˜¶æ®µ)
- models/enums.py: TaskStatus æšä¸¾ (pending/scheduled/running/success/failed/skipped/cancelled/paused)
- models/task.py: Task æ•°æ®ç±»ï¼ŒåŒ…å« scheduled_time, priority, retry_count ç­‰
- data/database.py: SQLite æ“ä½œï¼ŒåŒ…å« tasks è¡¨å’Œ idempotent_keys è¡¨
- config.yaml: schedule é…ç½® (default_interval, daily_limit, active_hours)

# ä½ çš„ä»»åŠ¡
å¼€å‘ scheduler/ ç›®å½•ä¸‹çš„è°ƒåº¦æ¨¡å—ã€‚

# éœ€è¦åˆ›å»ºçš„æ–‡ä»¶

## 1. scheduler/queue_manager.py
ä»»åŠ¡é˜Ÿåˆ—ç®¡ç†å™¨ï¼š
- ç»´æŠ¤å¾…æ‰§è¡Œä»»åŠ¡é˜Ÿåˆ—
- æŒ‰ä¼˜å…ˆçº§ + æ—¶é—´æ’åº
- å…¨å±€æ‰§è¡Œé” (åŒä¸€æ—¶åˆ»åªèƒ½æ‰§è¡Œä¸€ä¸ªä»»åŠ¡)
- ä»»åŠ¡çŠ¶æ€è½¬æ¢ç®¡ç†
- å¹‚ç­‰æ€§æ£€æŸ¥

æ ¸å¿ƒæ–¹æ³•ï¼š
- add_task(task, priority=5)
- get_next_task() -> Task
- is_executing() -> bool
- pause_queue() / resume_queue()
- get_queue_status() -> dict

## 2. scheduler/task_scheduler.py
å®šæ—¶ä»»åŠ¡è°ƒåº¦å™¨ï¼š
- åŸºäº APScheduler å®ç°
- æ£€æŸ¥ scheduled_time åˆ°æœŸçš„ä»»åŠ¡
- è§¦å‘ä»»åŠ¡æ‰§è¡Œ
- æ”¯æŒå¯åŠ¨æ—¶æ¢å¤æœªå®Œæˆä»»åŠ¡
- æ¼å‘æ£€æµ‹å’Œå¤„ç†

æ ¸å¿ƒæ–¹æ³•ï¼š
- start_scheduler()
- stop_scheduler()
- schedule_task(task, scheduled_time)
- cancel_task(task_id)
- check_missed_tasks() -> list

## 3. scheduler/idempotency_manager.py
å¹‚ç­‰æ€§ç®¡ç†å™¨ï¼š
- ç”Ÿæˆå¹‚ç­‰é”®: content_code + channel + group_name + date
- æ£€æŸ¥ä»»åŠ¡æ˜¯å¦å·²æˆåŠŸæ‰§è¡Œ
- äº‹åŠ¡æ€§æ£€æŸ¥å’Œè®°å½•

# å…³é”®çº¦æŸ
1. æ‰§è¡Œé”å¿…é¡»ä½¿ç”¨ threading.Lock
2. APScheduler ä½¿ç”¨ BackgroundScheduler
3. å¹‚ç­‰æ£€æŸ¥å’Œå†™å…¥å¿…é¡»åœ¨åŒä¸€äº‹åŠ¡
4. ç¨‹åºé‡å¯æ—¶ running çŠ¶æ€ä»»åŠ¡æ ‡è®°ä¸º failed

# è¾“å‡ºè¦æ±‚
- å®Œæ•´å®ç°çš„è°ƒåº¦æ¨¡å—
- çº¿ç¨‹å®‰å…¨çš„å®ç°
```

---

### çº¿ç¨‹ 2-D: å‰ªè´´æ¿ä¸ç¯å¢ƒæ£€æŸ¥

```
# è§’è‰²
ä½ æ˜¯ä¸€ä¸ª Windows ç³»ç»Ÿç¼–ç¨‹ä¸“å®¶ï¼Œè´Ÿè´£å‰ªè´´æ¿ç®¡ç†å’Œç¯å¢ƒæ£€æŸ¥ã€‚

# é¡¹ç›®èƒŒæ™¯
å¾®ä¿¡è‡ªåŠ¨å‘å¸ƒå·¥å…·ï¼ŒæŠ€æœ¯æ ˆï¼šPython + PySide6 + SQLite + uiautomation

# å·²å®Œæˆæ¨¡å— (ç¬¬ä¸€é˜¶æ®µ)
- config.yaml: display é…ç½® (min_resolution, primary_monitor_only, check_dpi_scaling)
- config.yaml: paths é…ç½® (shared_folder, cache_dir)
- main.py: å·²æœ‰åŸºç¡€ç¯å¢ƒæ£€æŸ¥é€»è¾‘ (check_wechat_login, check_shared_folder, check_screen_resolution)

# ä½ çš„ä»»åŠ¡
å¼€å‘å‰ªè´´æ¿ç®¡ç†å’Œç¯å¢ƒæ£€æŸ¥æ¨¡å—ï¼Œæ‰©å±•å’Œå®Œå–„ main.py ä¸­çš„åŸºç¡€æ£€æŸ¥ã€‚

# éœ€è¦åˆ›å»ºçš„æ–‡ä»¶

## 1. core/clipboard_manager.py
å‰ªè´´æ¿å®‰å…¨ç®¡ç†å™¨ï¼š
- å¤‡ä»½å½“å‰å‰ªè´´æ¿å†…å®¹
- å†™å…¥æ–°å†…å®¹ (æ–‡æœ¬/å›¾ç‰‡)
- éªŒè¯å†…å®¹æœªè¢«ç¯¡æ”¹
- æ¢å¤åŸå§‹å‰ªè´´æ¿å†…å®¹
- ä½¿ç”¨ pywin32 çš„ win32clipboard

æ ¸å¿ƒæ–¹æ³•ï¼š
- backup() -> å¤‡ä»½å½“å‰å†…å®¹
- restore() -> æ¢å¤åŸå§‹å†…å®¹
- set_text(text: str) -> bool
- set_image(image_path: str) -> bool
- verify_text(expected: str) -> bool

## 2. core/env_checker.py
ç¯å¢ƒè‡ªæ£€æ¨¡å—ï¼š
æ£€æŸ¥é¡¹ï¼š
- å¾®ä¿¡è¿›ç¨‹æ˜¯å¦è¿è¡Œ
- å¾®ä¿¡æ˜¯å¦å·²ç™»å½•
- å…±äº«æ–‡ä»¶å¤¹æ˜¯å¦å¯è®¿é—®
- å±å¹•åˆ†è¾¨ç‡æ˜¯å¦æ»¡è¶³ (>=900x700)
- DPI ç¼©æ”¾æ¯”ä¾‹
- ä¸»æ˜¾ç¤ºå™¨æ£€æµ‹

æ ¸å¿ƒæ–¹æ³•ï¼š
- check_all() -> EnvCheckResult
- check_wechat_running() -> bool
- check_wechat_login() -> bool
- check_shared_folder(path: str) -> bool
- check_display() -> DisplayInfo
- get_primary_monitor() -> MonitorInfo

## 3. core/display_manager.py
æ˜¾ç¤ºå™¨ç®¡ç†ï¼š
- è·å–æ‰€æœ‰æ˜¾ç¤ºå™¨ä¿¡æ¯
- è·å–ä¸»æ˜¾ç¤ºå™¨
- çª—å£ç§»åŠ¨åˆ°ä¸»æ˜¾ç¤ºå™¨
- DPI æ„ŸçŸ¥å¤„ç†

# å…³é”®çº¦æŸ
1. å‰ªè´´æ¿æ“ä½œéœ€è¦ try-finally ç¡®ä¿é‡Šæ”¾
2. ç¯å¢ƒæ£€æŸ¥å¤±è´¥è¦ç»™å‡ºæ˜ç¡®é”™è¯¯ä¿¡æ¯
3. æ”¯æŒå¤šæ˜¾ç¤ºå™¨ç¯å¢ƒ
4. ä½¿ç”¨ ctypes è·å– DPI ä¿¡æ¯

# è¾“å‡ºè¦æ±‚
- å®Œæ•´å®ç°çš„æ¨¡å—
- åŒ…å«è¯¦ç»†çš„é”™è¯¯å¤„ç†
```

</details>

---

### ç¬¬ä¸‰é˜¶æ®µï¼šå‘å¸ƒæ‰§è¡Œå™¨ (2ä¸ªå¹¶è¡Œçº¿ç¨‹) - âœ… å·²å®Œæˆ

> **çŠ¶æ€**: å·²å®Œæˆ (2025-12-04)
> **å®¡æ ¸è¯„åˆ†**: 83/100
>
> å·²å®Œæˆæ¨¡å—:
> - core/moment_sender.py (85/100)
> - core/group_sender.py (82/100)
>
> éœ€ä¿®å¤çš„é›†æˆé—®é¢˜:
> - ğŸ”´ GroupSender æœªåœ¨ core/__init__.py å¯¼å‡º
> - ğŸ”´ group_sender.py é‡å¤å®šä¹‰äº† Content ç±»
> - ğŸ”´ SendStatus æšä¸¾å®šä¹‰ä¸ä¸€è‡´
> - ğŸŸ¡ æœªé›†æˆ ElementLocator (ç¡¬ç¼–ç é€‰æ‹©å™¨)
> - ğŸŸ¡ æ¶ˆæ¯æ°”æ³¡éªŒè¯é€»è¾‘ç®€é™‹

| çº¿ç¨‹ | æ¨¡å— | è¯´æ˜ |
|------|------|------|
| 3-A | moment_sender.py | æœ‹å‹åœˆå‘å¸ƒå™¨ |
| 3-B | group_sender.py | ç¾¤å‘æ¶ˆæ¯å™¨ |

<details>
<summary>ç‚¹å‡»å±•å¼€ç¬¬ä¸‰é˜¶æ®µæç¤ºè¯ (å·²å®Œæˆ)</summary>

### çº¿ç¨‹ 3-A: æœ‹å‹åœˆå‘å¸ƒå™¨

```
# è§’è‰²
ä½ æ˜¯ä¸€ä¸ª UI è‡ªåŠ¨åŒ–ä¸“å®¶ï¼Œè´Ÿè´£å®ç°æœ‹å‹åœˆå‘å¸ƒåŠŸèƒ½ã€‚

# ä½ çš„ä»»åŠ¡
å¼€å‘æœ‹å‹åœˆè‡ªåŠ¨å‘å¸ƒæ¨¡å—ã€‚

# éœ€è¦åˆ›å»ºçš„æ–‡ä»¶

## 1. core/moment_sender.py
æœ‹å‹åœˆå‘å¸ƒå™¨ï¼š

å‘å¸ƒæµç¨‹ï¼š
1. æ¿€æ´»å¾®ä¿¡çª—å£
2. ç‚¹å‡»"å‘ç°"æ ‡ç­¾
3. ç‚¹å‡»"æœ‹å‹åœˆ"å…¥å£
4. ç­‰å¾…æœ‹å‹åœˆé¡µé¢åŠ è½½
5. ç‚¹å‡»ç›¸æœºå›¾æ ‡ (é•¿æŒ‰é€‰æ‹©çº¯æ–‡å­—/çŸ­æŒ‰é€‰æ‹©å›¾æ–‡)
6. å¦‚æœ‰å›¾ç‰‡ï¼š
   - ç‚¹å‡»æ·»åŠ å›¾ç‰‡åŒºåŸŸ
   - é€šè¿‡å‰ªè´´æ¿ç²˜è´´å›¾ç‰‡ (æ¯æ¬¡1å¼ )
   - é‡å¤ç›´åˆ°æ‰€æœ‰å›¾ç‰‡æ·»åŠ å®Œæˆ
7. ç‚¹å‡»æ–‡æœ¬è¾“å…¥æ¡†
8. ç²˜è´´æ–‡æ¡ˆå†…å®¹
9. ç‚¹å‡»"å‘è¡¨"æŒ‰é’®
10. ç­‰å¾…å‘å¸ƒå®Œæˆ
11. è¿”å›ä¸»ç•Œé¢

æ ¸å¿ƒæ–¹æ³•ï¼š
- send_moment(content: Content) -> SendResult
- _navigate_to_moment() -> bool
- _open_compose_dialog(has_images: bool) -> bool
- _add_images(image_paths: list) -> bool
- _input_text(text: str) -> bool
- _click_publish() -> bool
- _wait_for_publish_complete() -> bool
- _return_to_main() -> bool

# å…³é”®çº¦æŸ
1. æ¯æ­¥æ“ä½œåéœ€ç­‰å¾… (0.5-1s)
2. æ¯æ­¥æ“ä½œéœ€è¦éªŒè¯æˆåŠŸ
3. å¤±è´¥æ—¶æˆªå›¾ä¿å­˜
4. å›¾ç‰‡é€šè¿‡å‰ªè´´æ¿ç²˜è´´ï¼Œä¸æ˜¯æ–‡ä»¶é€‰æ‹©å¯¹è¯æ¡†
5. æœ€å¤š 9 å¼ å›¾ç‰‡
6. æ“ä½œä½¿ç”¨ PyAutoGUI + uiautomation

# è¾“å‡ºè¦æ±‚
- å®Œæ•´å®ç°çš„æœ‹å‹åœˆå‘å¸ƒå™¨
- è¯¦ç»†çš„æ—¥å¿—è®°å½•
- å¼‚å¸¸å¤„ç†å’Œå›æ»š
```

---

### çº¿ç¨‹ 3-B: ç¾¤å‘æ¶ˆæ¯å™¨

```
# è§’è‰²
ä½ æ˜¯ä¸€ä¸ª UI è‡ªåŠ¨åŒ–ä¸“å®¶ï¼Œè´Ÿè´£å®ç°ç¾¤å‘æ¶ˆæ¯åŠŸèƒ½ã€‚

# ä½ çš„ä»»åŠ¡
å¼€å‘ç¾¤å‘æ¶ˆæ¯æ¨¡å—ã€‚

# éœ€è¦åˆ›å»ºçš„æ–‡ä»¶

## 1. core/group_sender.py
ç¾¤å‘æ¶ˆæ¯å™¨ï¼š

å‘å¸ƒæµç¨‹ï¼š
1. æ¿€æ´»å¾®ä¿¡çª—å£
2. ä½¿ç”¨æœç´¢æ¡†æœç´¢ç¾¤å
3. ç‚¹å‡»æœç´¢ç»“æœè¿›å…¥ç¾¤èŠ
4. ç­‰å¾…èŠå¤©çª—å£åŠ è½½
5. å¦‚æœ‰å›¾ç‰‡ï¼š
   - é€šè¿‡å‰ªè´´æ¿ç²˜è´´å›¾ç‰‡
6. å¦‚æœ‰æ–‡æ¡ˆï¼š
   - ç‚¹å‡»è¾“å…¥æ¡†
   - ç²˜è´´æ–‡æ¡ˆ
7. æŒ‰ Enter æˆ–ç‚¹å‡»å‘é€æŒ‰é’®
8. ç­‰å¾…å‘é€å®Œæˆ (æ£€æŸ¥æ¶ˆæ¯æ°”æ³¡)
9. è¿”å›ä¸»ç•Œé¢

æ ¸å¿ƒæ–¹æ³•ï¼š
- send_to_group(group_name: str, content: Content) -> SendResult
- _search_group(group_name: str) -> bool
- _enter_chat() -> bool
- _send_images(image_paths: list) -> bool
- _send_text(text: str) -> bool
- _wait_for_send_complete() -> bool
- _return_to_main() -> bool

æ‰¹é‡å‘é€ï¼š
- send_to_groups(group_names: list, content: Content) -> list[SendResult]
  - å¾ªç¯è°ƒç”¨ send_to_group
  - æ¯ä¸ªç¾¤ä¹‹é—´é—´éš”å¯é…ç½®

# å…³é”®çº¦æŸ
1. ç¾¤åæœç´¢éœ€ç²¾ç¡®åŒ¹é…
2. æœç´¢æ— ç»“æœéœ€è¦å¤„ç†
3. å‘é€åéªŒè¯æ¶ˆæ¯æ°”æ³¡å‡ºç°
4. å›¾ç‰‡å’Œæ–‡æ¡ˆå¯ä»¥åˆ†å¼€å‘é€
5. æ”¯æŒçº¯æ–‡å­—/çº¯å›¾ç‰‡/å›¾æ–‡æ··åˆ

# è¾“å‡ºè¦æ±‚
- å®Œæ•´å®ç°çš„ç¾¤å‘æ¶ˆæ¯å™¨
- æ”¯æŒæ‰¹é‡ç¾¤å‘
- æ¯ç¾¤ç‹¬ç«‹çš„å‘é€ç»“æœ
```

</details>

---

## äº”ã€å½“å‰5çº¿ç¨‹å¹¶è¡Œå¼€å‘æç¤ºè¯

> **å½“å‰é˜¶æ®µ**: Phase 3ä¿®å¤ + Phase 4 + Phase 5 åŒæ—¶è¿›è¡Œ
> **å¯ç”¨çº¿ç¨‹æ•°**: 5
> **é¢„è®¡äº§å‡º**: 15ä¸ªæ¨¡å—æ–‡ä»¶

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    5 çº¿ç¨‹å¹¶è¡Œå¼€å‘è®¡åˆ’                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  ã€çº¿ç¨‹ 1ã€‘Phase 3 ä¿®å¤ (é›†æˆé—®é¢˜)                               â”‚
â”‚  â”œâ”€â”€ ä¿®å¤ core/__init__.py å¯¼å‡º                                 â”‚
â”‚  â”œâ”€â”€ ç»Ÿä¸€ SendStatus/SendResult å®šä¹‰                            â”‚
â”‚  â””â”€â”€ åˆ é™¤ group_sender.py ä¸­çš„é‡å¤ç±»                            â”‚
â”‚                                                                 â”‚
â”‚  ã€çº¿ç¨‹ 2ã€‘Phase 4-A: é£æ§æ£€æµ‹                                   â”‚
â”‚  â”œâ”€â”€ core/popup_detector.py                                     â”‚
â”‚  â”œâ”€â”€ core/risk_detector.py                                      â”‚
â”‚  â””â”€â”€ core/shutdown_controller.py                                â”‚
â”‚                                                                 â”‚
â”‚  ã€çº¿ç¨‹ 3ã€‘Phase 4-B: ç†”æ–­ä¸é‡è¯•                                 â”‚
â”‚  â”œâ”€â”€ scheduler/circuit_breaker.py                               â”‚
â”‚  â”œâ”€â”€ scheduler/retry_handler.py                                 â”‚
â”‚  â””â”€â”€ scheduler/rate_limiter.py                                  â”‚
â”‚                                                                 â”‚
â”‚  ã€çº¿ç¨‹ 4ã€‘Phase 5-A: GUIä¸»çª—å£                                  â”‚
â”‚  â”œâ”€â”€ gui/main_window.py                                         â”‚
â”‚  â”œâ”€â”€ gui/queue_tab.py                                           â”‚
â”‚  â””â”€â”€ gui/styles.py                                              â”‚
â”‚                                                                 â”‚
â”‚  ã€çº¿ç¨‹ 5ã€‘Phase 5-B: GUIè®¾ç½®é¡µ                                  â”‚
â”‚  â”œâ”€â”€ gui/schedule_tab.py                                        â”‚
â”‚  â””â”€â”€ gui/settings_tab.py                                        â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### çº¿ç¨‹ 1: Phase 3 é›†æˆä¿®å¤

```
# è§’è‰²
ä½ æ˜¯ä¸€ä¸ª Python ä»£ç é‡æ„ä¸“å®¶ï¼Œè´Ÿè´£ä¿®å¤æ¨¡å—é›†æˆé—®é¢˜ã€‚

# é¡¹ç›®èƒŒæ™¯
å¾®ä¿¡è‡ªåŠ¨å‘å¸ƒå·¥å…·ï¼ŒæŠ€æœ¯æ ˆï¼šPython + PySide6 + SQLite + uiautomation

# å·²å®Œæˆæ¨¡å—
- models/enums.py: TaskStatus, Channel, RiskLevel, CircuitState æšä¸¾
- models/content.py: Content æ•°æ®ç±»
- core/moment_sender.py: æœ‹å‹åœˆå‘å¸ƒå™¨ (æœ‰é›†æˆé—®é¢˜)
- core/group_sender.py: ç¾¤å‘æ¶ˆæ¯å™¨ (æœ‰é›†æˆé—®é¢˜)

# ä½ çš„ä»»åŠ¡
ä¿®å¤ç¬¬ä¸‰é˜¶æ®µçš„é›†æˆé—®é¢˜ï¼Œç¡®ä¿æ¨¡å—é—´ä¸€è‡´æ€§ã€‚

# éœ€è¦ä¿®å¤çš„é—®é¢˜

## 1. core/__init__.py - è¡¥å……å¯¼å‡º
æ·»åŠ  GroupSender ç›¸å…³å¯¼å‡ºï¼š
- from .group_sender import GroupSender, get_group_sender, SendResult as GroupSendResult

## 2. ç»Ÿä¸€ SendStatus æšä¸¾
åœ¨ models/enums.py ä¸­æ·»åŠ ç»Ÿä¸€çš„ SendStatusï¼š
class SendStatus(str, Enum):
    SUCCESS = "success"
    FAILED = "failed"
    PARTIAL = "partial"
    TIMEOUT = "timeout"
    CANCELLED = "cancelled"
    GROUP_NOT_FOUND = "group_not_found"
    WECHAT_ERROR = "wechat_error"

## 3. group_sender.py ä¿®å¤
- åˆ é™¤æœ¬åœ° Content ç±»å®šä¹‰ (ç¬¬57-87è¡Œ)
- åˆ é™¤æœ¬åœ° SendStatus æšä¸¾
- æ·»åŠ å¯¼å…¥: from models.content import Content
- æ·»åŠ å¯¼å…¥: from models.enums import SendStatus
- å±æ€§å‘½åç»Ÿä¸€ä¸º self._xxx (ç§æœ‰)

## 4. moment_sender.py ä¿®å¤
- åˆ é™¤æœ¬åœ° SendStatus æšä¸¾
- æ·»åŠ å¯¼å…¥: from models.enums import SendStatus
- å±æ€§å‘½åç»Ÿä¸€ä¸º self._xxx (ç§æœ‰)

# å…³é”®çº¦æŸ
1. ä¸è¦ä¿®æ”¹æ ¸å¿ƒå‘é€é€»è¾‘
2. ä¿æŒå‘åå…¼å®¹
3. ç¡®ä¿ä¸¤ä¸ªæ¨¡å—çš„ SendResult å¯ä»¥è¢«ç»Ÿä¸€å¤„ç†

# è¾“å‡ºè¦æ±‚
- ä¿®æ”¹åçš„æ–‡ä»¶å®Œæ•´ä»£ç 
- ä¿®æ”¹è¯´æ˜
```

---

### çº¿ç¨‹ 2: Phase 4-A é£æ§æ£€æµ‹ (ä¼˜åŒ–ç‰ˆ)

```
# è§’è‰²
ä½ æ˜¯ä¸€ä¸ªå®‰å…¨ç³»ç»Ÿä¸“å®¶ï¼Œè´Ÿè´£å®ç°é£æ§æ£€æµ‹å’Œåœæœºä¿æŠ¤ã€‚

# é¡¹ç›®èƒŒæ™¯
å¾®ä¿¡è‡ªåŠ¨å‘å¸ƒå·¥å…·ï¼ŒæŠ€æœ¯æ ˆï¼šPython + PySide6 + SQLite + uiautomation

# å·²å®Œæˆæ¨¡å— (ç¬¬ä¸€ã€äºŒé˜¶æ®µ)
- models/enums.py: RiskLevel æšä¸¾ (low/medium/high/critical)
- core/wechat_controller.py: å¾®ä¿¡çª—å£æ§åˆ¶ï¼Œget_wechat_controller()
- core/element_locator.py: UIå…ƒç´ å®šä½ï¼Œfind_element(), wait_for_element()
- selectors.yaml: UIé€‰æ‹©å™¨é…ç½®
- config.yaml: åŒ…å« circuit_breaker é…ç½®é¡¹

# ä½ çš„ä»»åŠ¡
å¼€å‘é£æ§æ£€æµ‹å’Œåœæœºæ§åˆ¶æ¨¡å—ã€‚

# éœ€è¦åˆ›å»ºçš„æ–‡ä»¶

## 1. core/popup_detector.py
å¼¹çª—æ£€æµ‹å™¨ï¼š
- æ£€æµ‹å¾®ä¿¡å¼¹çª— (ç¡®è®¤æ¡†ã€è­¦å‘Šæ¡†ã€æç¤ºæ¡†)
- è‡ªåŠ¨å…³é—­éå…³é”®å¼¹çª—
- è¯†åˆ«é£æ§ç›¸å…³å¼¹çª—
- ä½¿ç”¨ core/element_locator.py è¿›è¡Œå…ƒç´ å®šä½

æ ¸å¿ƒæ–¹æ³•ï¼š
- detect_popup() -> Optional[PopupInfo]
- close_popup(popup: PopupInfo) -> bool
- is_risk_popup(popup: PopupInfo) -> bool

## 2. core/risk_detector.py
é£æ§æ£€æµ‹å™¨ï¼š
- çª—å£æ ‡é¢˜å…³é”®è¯æ£€æµ‹
- æˆªå›¾ OCR æ£€æµ‹ (å¯é€‰ï¼Œä½¿ç”¨ pytesseract)
- æ“ä½œç»“æœåˆ¤æ–­
- ä½¿ç”¨ models/enums.py çš„ RiskLevel

é£æ§å…³é”®è¯ï¼š
- CRITICAL: "è´¦å·å·²è¢«å°ç¦", "ç™»å½•å—é™", "è´¦å·å¼‚å¸¸"
- HIGH: "å®‰å…¨éªŒè¯", "éªŒè¯ç ", "åŠŸèƒ½ä¸å¯ç”¨"
- MEDIUM: "å‘é€è¿‡äºé¢‘ç¹", "æ¶ˆæ¯å‘é€å¤±è´¥"

æ ¸å¿ƒæ–¹æ³•ï¼š
- detect_risk() -> RiskDetectionResult
- check_window_title() -> Optional[RiskLevel]
- check_popup_content() -> Optional[RiskLevel]

## 3. core/shutdown_controller.py
åœæœºæ§åˆ¶å™¨ï¼š
- å¤„ç†ä¸åŒçº§åˆ«çš„é£æ§äº‹ä»¶
- å†™å…¥åœæœºæ ‡è®°æ–‡ä»¶ (cache/.shutdown_flag)
- å‘é€å‘Šè­¦é€šçŸ¥ (è°ƒç”¨ notification_manager)
- ä¿å­˜çŠ¶æ€å¿«ç…§
- å¯åŠ¨æ—¶æ£€æŸ¥åœæœºæ ‡è®°

åœæœºæ ‡è®°æ–‡ä»¶ JSON æ ¼å¼ï¼š
{
  "shutdown_time": "2024-12-04T10:30:00",
  "risk_level": "high",
  "event_type": "å®‰å…¨éªŒè¯å¼¹çª—",
  "screenshot_path": "screenshots/risk_xxx.png",
  "recovery_hint": "è¯·æ£€æŸ¥å¾®ä¿¡è´¦å·çŠ¶æ€ååˆ é™¤æ­¤æ–‡ä»¶"
}

æ ¸å¿ƒæ–¹æ³•ï¼š
- handle_risk_event(risk: RiskDetectionResult) -> None
- create_shutdown_flag(reason: str, level: RiskLevel) -> None
- check_shutdown_flag() -> Optional[ShutdownInfo]
- clear_shutdown_flag() -> bool

# å…³é”®çº¦æŸ
1. MEDIUM åŠä»¥ä¸Šé£é™©ç«‹å³åœæœº
2. åœæœºæ ‡è®°æ–‡ä»¶é˜»æ­¢ç¨‹åºé‡å¯
3. éœ€è¦äººå·¥åˆ é™¤æ ‡è®°æ–‡ä»¶æ‰èƒ½æ¢å¤
4. æ‰€æœ‰é£æ§äº‹ä»¶è®°å½•åˆ°æ—¥å¿—
5. ä½¿ç”¨å·²æœ‰çš„ element_locator è¿›è¡Œ UI æ£€æµ‹

# è¾“å‡ºè¦æ±‚
- å®Œæ•´çš„é£æ§æ£€æµ‹é“¾è·¯
- ä¼˜é›…åœæœºå®ç°
- åŒ…å«ç±»å‹æ³¨è§£å’Œæ–‡æ¡£å­—ç¬¦ä¸²
```

---

### çº¿ç¨‹ 3: Phase 4-B ç†”æ–­ä¸é‡è¯• (ä¼˜åŒ–ç‰ˆ)

```
# è§’è‰²
ä½ æ˜¯ä¸€ä¸ªç³»ç»Ÿç¨³å®šæ€§ä¸“å®¶ï¼Œè´Ÿè´£å®ç°ç†”æ–­å’Œé‡è¯•æœºåˆ¶ã€‚

# é¡¹ç›®èƒŒæ™¯
å¾®ä¿¡è‡ªåŠ¨å‘å¸ƒå·¥å…·ï¼ŒæŠ€æœ¯æ ˆï¼šPython + PySide6 + SQLite + uiautomation

# å·²å®Œæˆæ¨¡å— (ç¬¬ä¸€ã€äºŒé˜¶æ®µ)
- models/enums.py: CircuitState æšä¸¾ (closed/open/half_open)
- models/task.py: Task æ•°æ®ç±»ï¼ŒåŒ…å« retry_count, max_retry
- scheduler/queue_manager.py: ä»»åŠ¡é˜Ÿåˆ—ï¼Œpause_queue()/resume_queue()
- scheduler/task_scheduler.py: å®šæ—¶è°ƒåº¦
- data/database.py: æ•°æ®åº“æ“ä½œ
- config.yaml: åŒ…å«ä»¥ä¸‹é…ç½®
  - schedule.daily_limit: æ¯æ—¥é™é¢
  - schedule.default_interval: é»˜è®¤é—´éš” (180ç§’)
  - circuit_breaker.failure_threshold: å¤±è´¥é˜ˆå€¼ (3)
  - circuit_breaker.recovery_timeout: æ¢å¤è¶…æ—¶ (300ç§’)

# ä½ çš„ä»»åŠ¡
å¼€å‘ç†”æ–­å™¨å’Œé‡è¯•å¤„ç†æ¨¡å—ã€‚

# éœ€è¦åˆ›å»ºçš„æ–‡ä»¶

## 1. scheduler/circuit_breaker.py
ç†”æ–­å™¨ï¼š
- ä¸‰ç§çŠ¶æ€ï¼šCLOSED(æ­£å¸¸) / OPEN(ç†”æ–­) / HALF_OPEN(è¯•æ¢)
- è¿ç»­å¤±è´¥ >= failure_threshold æ¬¡è§¦å‘ç†”æ–­
- å†·å´æ—¶é—´ recovery_timeout åè¿›å…¥ HALF_OPEN
- HALF_OPEN æˆåŠŸåˆ™æ¢å¤ï¼Œå¤±è´¥åˆ™é‡æ–°ç†”æ–­
- æ”¯æŒæ‰‹åŠ¨å¼ºåˆ¶æ¢å¤
- ç†”æ–­æ—¶è°ƒç”¨ queue_manager.pause_queue()
- æ¢å¤æ—¶è°ƒç”¨ queue_manager.resume_queue()

æ ¸å¿ƒæ–¹æ³•ï¼š
- record_success() -> None
- record_failure(error: str) -> None
- can_execute() -> bool
- force_reset() -> None
- get_state() -> CircuitState
- get_status() -> dict

## 2. scheduler/retry_handler.py
é‡è¯•å¤„ç†å™¨ï¼š
- æŒ‡æ•°é€€é¿ç­–ç•¥
- æœ€å¤§é‡è¯•æ¬¡æ•°é™åˆ¶ (ä½¿ç”¨ task.max_retryï¼Œé»˜è®¤ 3 æ¬¡)
- é‡è¯•é—´éš”ï¼šbase_delay * (2 ** retry_count)
- é»˜è®¤é—´éš”ï¼š10min, 20min, 40min
- å¯é…ç½®çš„é‡è¯•æ¡ä»¶ (å“ªäº›é”™è¯¯å¯ä»¥é‡è¯•)

æ ¸å¿ƒæ–¹æ³•ï¼š
- should_retry(task: Task, error: str) -> bool
- get_retry_delay(task: Task) -> int
- schedule_retry(task: Task) -> bool
- get_retryable_errors() -> List[str]

## 3. scheduler/rate_limiter.py
è‡ªé€‚åº”é€Ÿç‡é™åˆ¶å™¨ï¼š
- åŸºç¡€é—´éš”ä» config.yaml è¯»å– (é»˜è®¤ 180 ç§’)
- æ ¹æ®å¤±è´¥ç‡åŠ¨æ€è°ƒæ•´ï¼š
  - å¤±è´¥ç‡ < 10%: åŸºç¡€é—´éš”
  - å¤±è´¥ç‡ 10-30%: é—´éš” * 1.5
  - å¤±è´¥ç‡ > 30%: é—´éš” * 2
- æ·»åŠ éšæœºæŠ–åŠ¨ (-30s ~ +60s)
- æ£€æŸ¥æ¯æ—¥é™é¢

æ ¸å¿ƒæ–¹æ³•ï¼š
- get_next_delay() -> int
- record_result(success: bool) -> None
- can_send_today() -> bool
- get_today_count() -> int
- get_remaining_quota() -> int

# å…³é”®çº¦æŸ
1. ç†”æ–­è§¦å‘æ—¶æš‚åœæ‰€æœ‰ scheduled ä»»åŠ¡
2. ç†”æ–­æ¢å¤æ—¶æ¢å¤ paused ä»»åŠ¡
3. é‡è¯•ä¸èƒ½è¶…è¿‡æ¯æ—¥é™é¢
4. å‘é€é‚®ä»¶é€šçŸ¥ç†”æ–­äº‹ä»¶ (é¢„ç•™æ¥å£)
5. çº¿ç¨‹å®‰å…¨ (ä½¿ç”¨ threading.Lock)

# è¾“å‡ºè¦æ±‚
- å®Œæ•´çš„ç†”æ–­å™¨å®ç°
- æŒ‡æ•°é€€é¿é‡è¯•é€»è¾‘
- è‡ªé€‚åº”é€Ÿç‡é™åˆ¶
```

---

### çº¿ç¨‹ 4: Phase 5-A GUIä¸»çª—å£

```
# è§’è‰²
ä½ æ˜¯ä¸€ä¸ª PySide6 GUI å¼€å‘ä¸“å®¶ï¼Œè´Ÿè´£ä¸»çª—å£å’Œé˜Ÿåˆ—æ ‡ç­¾é¡µã€‚

# é¡¹ç›®èƒŒæ™¯
å¾®ä¿¡è‡ªåŠ¨å‘å¸ƒå·¥å…·ï¼ŒæŠ€æœ¯æ ˆï¼šPython + PySide6 + SQLite + uiautomation

# å·²å®Œæˆæ¨¡å—
- models/task.py: Task æ•°æ®ç±»
- models/enums.py: TaskStatus, Channel æšä¸¾
- scheduler/queue_manager.py: ä»»åŠ¡é˜Ÿåˆ—ç®¡ç†
- scheduler/task_scheduler.py: å®šæ—¶è°ƒåº¦
- data/database.py: æ•°æ®åº“æ“ä½œ
- data/excel_parser.py: Excel è§£æ

# ä½ çš„ä»»åŠ¡
å¼€å‘ä¸»çª—å£æ¡†æ¶å’Œå‘å¸ƒé˜Ÿåˆ—æ ‡ç­¾é¡µã€‚

# éœ€è¦åˆ›å»ºçš„æ–‡ä»¶

## 1. gui/main_window.py
ä¸»çª—å£ï¼š
- QMainWindow ä½œä¸ºå®¹å™¨
- QTabWidget åŒ…å« 4 ä¸ªæ ‡ç­¾é¡µ (é˜Ÿåˆ—/å®šæ—¶/ç»Ÿè®¡/è®¾ç½®)
- çŠ¶æ€æ æ˜¾ç¤ºï¼šçŠ¶æ€å›¾æ ‡ + æ¶ˆæ¯ + é˜Ÿåˆ—æ•°é‡ + ä»Šæ—¥æˆåŠŸæ•°
- ç³»ç»Ÿæ‰˜ç›˜å›¾æ ‡ + å³é”®èœå• (æ˜¾ç¤º/æš‚åœ/é€€å‡º)
- çª—å£å…³é—­æ—¶æœ€å°åŒ–åˆ°æ‰˜ç›˜
- ä¿¡å·æ§½è¿æ¥å„ç»„ä»¶

æ ¸å¿ƒæ–¹æ³•ï¼š
- __init__(config, selectors)
- setup_ui()
- setup_tray_icon()
- update_status_bar(message, queue_count, success_count)
- closeEvent() é‡å†™

## 2. gui/queue_tab.py
å‘å¸ƒé˜Ÿåˆ—æ ‡ç­¾é¡µï¼š
- ä»»åŠ¡åˆ—è¡¨ä½¿ç”¨ QTableView + QStandardItemModel
- åˆ—ï¼šçŠ¶æ€å›¾æ ‡ã€äº§å“ç¼–ç ã€äº§å“åã€æ¸ é“ã€ç¾¤åã€æ’æœŸæ—¶é—´ã€æ“ä½œ
- æ”¯æŒæ‹–æ‹½æ’åº (QAbstractItemModel.moveRows)
- å³é”®èœå•ï¼šç«‹å³æ‰§è¡Œã€ç¼–è¾‘æ’æœŸã€å–æ¶ˆã€åˆ é™¤
- å·¥å…·æ ï¼šå¯¼å…¥Excelã€å¼€å§‹å‘å¸ƒã€æš‚åœã€å…¨é€‰ã€ç­›é€‰ä¸‹æ‹‰æ¡†
- ä»»åŠ¡çŠ¶æ€å®æ—¶æ›´æ–° (ä¿¡å·æ§½)

æ ¸å¿ƒæ–¹æ³•ï¼š
- load_tasks(tasks: List[Task])
- add_task(task: Task)
- update_task_status(task_id: str, status: TaskStatus)
- get_selected_tasks() -> List[Task]
- import_excel() -> None

## 3. gui/styles.py
ç»Ÿä¸€æ ·å¼å®šä¹‰ï¼š
- STATUS_COLORS: çŠ¶æ€é¢œè‰²æ˜ å°„
- STATUS_ICONS: çŠ¶æ€å›¾æ ‡è·¯å¾„æ˜ å°„
- BUTTON_STYLE: æŒ‰é’®æ ·å¼
- TABLE_STYLE: è¡¨æ ¼æ ·å¼
- å¯é€‰ï¼šæ·±è‰²/æµ…è‰²ä¸»é¢˜åˆ‡æ¢

# å…³é”®çº¦æŸ
1. ä½¿ç”¨ PySide6 (ä¸æ˜¯ PyQt)
2. ä»»åŠ¡åˆ—è¡¨ä½¿ç”¨ Model-View æ¨¡å¼
3. çŠ¶æ€æ›´æ–°ä½¿ç”¨ä¿¡å·æ§½æœºåˆ¶
4. UI çº¿ç¨‹ä¸æ‰§è¡Œè€—æ—¶æ“ä½œ (ä½¿ç”¨ QThread)

# è¾“å‡ºè¦æ±‚
- å®Œæ•´çš„ä¸»çª—å£å’Œé˜Ÿåˆ—æ ‡ç­¾é¡µ
- ç¾è§‚çš„ç°ä»£ UI é£æ ¼
- ä¿¡å·æ§½æœºåˆ¶å®Œå–„
```

---

### çº¿ç¨‹ 5: Phase 5-B GUIè®¾ç½®é¡µ

```
# è§’è‰²
ä½ æ˜¯ä¸€ä¸ª PySide6 GUI å¼€å‘ä¸“å®¶ï¼Œè´Ÿè´£å®šæ—¶è®¾ç½®å’Œç³»ç»Ÿè®¾ç½®é¡µé¢ã€‚

# é¡¹ç›®èƒŒæ™¯
å¾®ä¿¡è‡ªåŠ¨å‘å¸ƒå·¥å…·ï¼ŒæŠ€æœ¯æ ˆï¼šPython + PySide6 + SQLite + uiautomation

# å·²å®Œæˆæ¨¡å—
- services/config_manager.py: é…ç½®ç®¡ç†ï¼Œget_config()/save_config()
- config.yaml: é…ç½®æ–‡ä»¶æ¨¡æ¿

# ä½ çš„ä»»åŠ¡
å¼€å‘å®šæ—¶è®¾ç½®å’Œç³»ç»Ÿè®¾ç½®æ ‡ç­¾é¡µã€‚

# éœ€è¦åˆ›å»ºçš„æ–‡ä»¶

## 1. gui/schedule_tab.py
å®šæ—¶è®¾ç½®æ ‡ç­¾é¡µï¼š
- æ—¥å†è§†å›¾æ˜¾ç¤ºå·²æ’æœŸä»»åŠ¡ (QCalendarWidget)
- æ—¶é—´çº¿è§†å›¾ (ä»Šæ—¥ä»»åŠ¡åˆ—è¡¨ï¼ŒæŒ‰æ—¶é—´æ’åº)
- æ‰¹é‡æ’æœŸåŠŸèƒ½ï¼šé€‰æ‹©å¤šä¸ªä»»åŠ¡ -> è®¾ç½®é—´éš” -> è‡ªåŠ¨åˆ†é…æ—¶é—´
- æ’æœŸå†²çªæ£€æµ‹ (åŒä¸€æ—¶é—´å¤šä¸ªä»»åŠ¡)
- å¿«æ·æ“ä½œæŒ‰é’®ï¼šå‡åŒ€åˆ†å¸ƒã€æ¸…ç©ºæ’æœŸ

æ ¸å¿ƒæ–¹æ³•ï¼š
- load_scheduled_tasks(date: QDate)
- batch_schedule(tasks: List[Task], start_time, interval)
- check_conflicts() -> List[Conflict]
- distribute_evenly(tasks: List[Task], start, end)

## 2. gui/settings_tab.py
ç³»ç»Ÿè®¾ç½®æ ‡ç­¾é¡µï¼š
åˆ†ç»„ (QGroupBox)ï¼š
- è·¯å¾„è®¾ç½®ï¼šå…±äº«æ–‡ä»¶å¤¹ (å¸¦æµè§ˆæŒ‰é’®)ã€ç¼“å­˜ç›®å½•
- å‘å¸ƒè®¾ç½®ï¼šé»˜è®¤é—´éš”(QSpinBox)ã€æ¯æ—¥é™é¢ã€éšæœºå»¶è¿ŸèŒƒå›´
- é‚®ä»¶é€šçŸ¥ï¼šSMTPæœåŠ¡å™¨ã€ç«¯å£ã€å‘ä»¶äººã€å¯†ç (QLineEdit.Password)ã€æ”¶ä»¶äºº
- ç†”æ–­è®¾ç½®ï¼šå¤±è´¥é˜ˆå€¼ã€å†·å´æ—¶é—´
- æ˜¾ç¤ºè®¾ç½®ï¼šä¸»æ˜¾ç¤ºå™¨ä¼˜å…ˆ(QCheckBox)
- é«˜çº§è®¾ç½®ï¼šæ—¥å¿—çº§åˆ«(QComboBox)ã€è°ƒè¯•æ¨¡å¼

åŠŸèƒ½ï¼š
- é…ç½®ä¿å­˜ (è°ƒç”¨ config_manager.save_config)
- é…ç½®åŠ è½½ (è°ƒç”¨ config_manager.get_config)
- æ•æ„Ÿä¿¡æ¯è„±æ•æ˜¾ç¤º (å¯†ç æ˜¾ç¤º ****)
- é…ç½®éªŒè¯ (è·¯å¾„å­˜åœ¨æ€§ã€é‚®ç®±æ ¼å¼)
- æ¢å¤é»˜è®¤å€¼æŒ‰é’®

æ ¸å¿ƒæ–¹æ³•ï¼š
- load_settings()
- save_settings()
- validate_settings() -> List[str]
- reset_to_defaults()
- test_email_connection()

# å…³é”®çº¦æŸ
1. è®¾ç½®å˜æ›´éœ€ç‚¹å‡»ä¿å­˜æŒ‰é’®
2. é‚®ç®±å¯†ç åŠ å¯†å­˜å‚¨ (ä½¿ç”¨ config_manager çš„åŠ å¯†åŠŸèƒ½)
3. è·¯å¾„è®¾ç½®éœ€è¦éªŒè¯å¯è®¿é—®æ€§
4. è¡¨å•æ§ä»¶å¸ƒå±€ä½¿ç”¨ QFormLayout

# è¾“å‡ºè¦æ±‚
- å®Œæ•´çš„ä¸¤ä¸ªæ ‡ç­¾é¡µ
- è¡¨å•éªŒè¯å’Œé”™è¯¯æç¤º
- é…ç½®ä¿å­˜/åŠ è½½åŠŸèƒ½
```

---

### ç¬¬å››é˜¶æ®µï¼šå®‰å…¨ä¸ä¿æŠ¤ (2ä¸ªå¹¶è¡Œçº¿ç¨‹)

<details>
<summary>ç‚¹å‡»å±•å¼€ç¬¬å››é˜¶æ®µåŸå§‹æç¤ºè¯ (å·²ä¼˜åŒ–ï¼Œè§ä¸Šæ–¹çº¿ç¨‹2-3)</summary>

---

### çº¿ç¨‹ 4-A: é£æ§æ£€æµ‹ä¸åœæœº

```
# è§’è‰²
ä½ æ˜¯ä¸€ä¸ªå®‰å…¨ç³»ç»Ÿä¸“å®¶ï¼Œè´Ÿè´£å®ç°é£æ§æ£€æµ‹å’Œåœæœºä¿æŠ¤ã€‚

# ä½ çš„ä»»åŠ¡
å¼€å‘é£æ§æ£€æµ‹å’Œåœæœºæ§åˆ¶æ¨¡å—ã€‚

# éœ€è¦åˆ›å»ºçš„æ–‡ä»¶

## 1. core/popup_detector.py
å¼¹çª—æ£€æµ‹å™¨ï¼š
- æ£€æµ‹å¾®ä¿¡å¼¹çª— (ç¡®è®¤æ¡†ã€è­¦å‘Šæ¡†)
- è‡ªåŠ¨å…³é—­éå…³é”®å¼¹çª—
- è¯†åˆ«é£æ§ç›¸å…³å¼¹çª—

## 2. core/risk_detector.py
é£æ§æ£€æµ‹å™¨ï¼š
- çª—å£æ ‡é¢˜å…³é”®è¯æ£€æµ‹
- æˆªå›¾ OCR æ£€æµ‹ (å¯é€‰)
- æ“ä½œç»“æœåˆ¤æ–­

é£æ§å…³é”®è¯ï¼š
- CRITICAL: "è´¦å·å·²è¢«å°ç¦", "ç™»å½•å—é™", "è´¦å·å¼‚å¸¸"
- HIGH: "å®‰å…¨éªŒè¯", "éªŒè¯ç ", "åŠŸèƒ½ä¸å¯ç”¨"
- MEDIUM: "å‘é€è¿‡äºé¢‘ç¹", "æ¶ˆæ¯å‘é€å¤±è´¥"

## 3. core/shutdown_controller.py
åœæœºæ§åˆ¶å™¨ï¼š
- å¤„ç†ä¸åŒçº§åˆ«çš„é£æ§äº‹ä»¶
- å†™å…¥åœæœºæ ‡è®°æ–‡ä»¶ (.shutdown_flag)
- å‘é€å‘Šè­¦é€šçŸ¥
- ä¿å­˜çŠ¶æ€å¿«ç…§
- å¯åŠ¨æ—¶æ£€æŸ¥åœæœºæ ‡è®°

åœæœºæ ‡è®°æ–‡ä»¶å†…å®¹ï¼š
- åœæœºæ—¶é—´ã€äº‹ä»¶ç±»å‹ã€é£é™©ç­‰çº§
- æ¢å¤æŒ‡å¼•è¯´æ˜
- æˆªå›¾è·¯å¾„

# å…³é”®çº¦æŸ
1. MEDIUM åŠä»¥ä¸Šé£é™©ç«‹å³åœæœº
2. åœæœºæ ‡è®°æ–‡ä»¶é˜»æ­¢ç¨‹åºé‡å¯
3. éœ€è¦äººå·¥åˆ é™¤æ ‡è®°æ–‡ä»¶æ‰èƒ½æ¢å¤
4. æ‰€æœ‰é£æ§äº‹ä»¶è®°å½•åˆ°æ—¥å¿—

# è¾“å‡ºè¦æ±‚
- å®Œæ•´çš„é£æ§æ£€æµ‹é“¾è·¯
- ä¼˜é›…åœæœºå®ç°
```

---

### çº¿ç¨‹ 4-B: ç†”æ–­å™¨ä¸é‡è¯•

```
# è§’è‰²
ä½ æ˜¯ä¸€ä¸ªç³»ç»Ÿç¨³å®šæ€§ä¸“å®¶ï¼Œè´Ÿè´£å®ç°ç†”æ–­å’Œé‡è¯•æœºåˆ¶ã€‚

# ä½ çš„ä»»åŠ¡
å¼€å‘ç†”æ–­å™¨å’Œé‡è¯•å¤„ç†æ¨¡å—ã€‚

# éœ€è¦åˆ›å»ºçš„æ–‡ä»¶

## 1. scheduler/circuit_breaker.py
ç†”æ–­å™¨ï¼š
- ä¸‰ç§çŠ¶æ€ï¼šCLOSED(æ­£å¸¸) / OPEN(ç†”æ–­) / HALF_OPEN(è¯•æ¢)
- è¿ç»­å¤±è´¥ >= 3 æ¬¡è§¦å‘ç†”æ–­
- å†·å´æ—¶é—´ 5 åˆ†é’Ÿåè¿›å…¥ HALF_OPEN
- HALF_OPEN æˆåŠŸåˆ™æ¢å¤ï¼Œå¤±è´¥åˆ™é‡æ–°ç†”æ–­
- æ”¯æŒæ‰‹åŠ¨å¼ºåˆ¶æ¢å¤

æ ¸å¿ƒæ–¹æ³•ï¼š
- record_success()
- record_failure(error: str)
- can_execute() -> bool
- force_reset()
- get_state() -> CircuitState

## 2. scheduler/retry_handler.py
é‡è¯•å¤„ç†å™¨ï¼š
- æŒ‡æ•°é€€é¿ç­–ç•¥
- æœ€å¤§é‡è¯•æ¬¡æ•°é™åˆ¶ (é»˜è®¤ 3 æ¬¡)
- é‡è¯•é—´éš”ï¼š10min, 20min, 40min
- å¯é…ç½®çš„é‡è¯•æ¡ä»¶

æ ¸å¿ƒæ–¹æ³•ï¼š
- should_retry(task) -> bool
- get_retry_delay(retry_count: int) -> int
- execute_with_retry(task, executor) -> Result

## 3. scheduler/rate_limiter.py
è‡ªé€‚åº”é€Ÿç‡é™åˆ¶å™¨ï¼š
- åŸºç¡€é—´éš” 180 ç§’
- æ ¹æ®å¤±è´¥ç‡åŠ¨æ€è°ƒæ•´
- æ·»åŠ éšæœºæŠ–åŠ¨ (-30s ~ +60s)

# å…³é”®çº¦æŸ
1. ç†”æ–­è§¦å‘æ—¶æš‚åœæ‰€æœ‰ scheduled ä»»åŠ¡
2. ç†”æ–­æ¢å¤æ—¶æ¢å¤ paused ä»»åŠ¡
3. é‡è¯•ä¸èƒ½è¶…è¿‡æ¯æ—¥é™é¢
4. å‘é€é‚®ä»¶é€šçŸ¥ç†”æ–­äº‹ä»¶

# è¾“å‡ºè¦æ±‚
- å®Œæ•´çš„ç†”æ–­å™¨å®ç°
- æŒ‡æ•°é€€é¿é‡è¯•é€»è¾‘
```

</details>

---

### ç¬¬äº”é˜¶æ®µï¼šGUI ç•Œé¢ (3ä¸ªå¹¶è¡Œçº¿ç¨‹)

<details>
<summary>ç‚¹å‡»å±•å¼€ç¬¬äº”é˜¶æ®µåŸå§‹æç¤ºè¯ (å·²ä¼˜åŒ–ï¼Œè§ä¸Šæ–¹çº¿ç¨‹4-5)</summary>

---

### çº¿ç¨‹ 5-A: ä¸»çª—å£ä¸é˜Ÿåˆ—æ ‡ç­¾é¡µ

```
# è§’è‰²
ä½ æ˜¯ä¸€ä¸ª PySide6 GUI å¼€å‘ä¸“å®¶ï¼Œè´Ÿè´£ä¸»çª—å£å’Œé˜Ÿåˆ—æ ‡ç­¾é¡µã€‚

# ä½ çš„ä»»åŠ¡
å¼€å‘ä¸»çª—å£æ¡†æ¶å’Œå‘å¸ƒé˜Ÿåˆ—æ ‡ç­¾é¡µã€‚

# éœ€è¦åˆ›å»ºçš„æ–‡ä»¶

## 1. gui/main_window.py
ä¸»çª—å£ï¼š
- QMainWindow ä½œä¸ºå®¹å™¨
- QTabWidget åŒ…å« 4 ä¸ªæ ‡ç­¾é¡µ
- çŠ¶æ€æ æ˜¾ç¤ºï¼šçŠ¶æ€å›¾æ ‡ + æ¶ˆæ¯ + é˜Ÿåˆ—æ•°é‡ + ä»Šæ—¥æˆåŠŸæ•°
- ç³»ç»Ÿæ‰˜ç›˜å›¾æ ‡ + å³é”®èœå•
- çª—å£å…³é—­æ—¶æœ€å°åŒ–åˆ°æ‰˜ç›˜

## 2. gui/queue_tab.py
å‘å¸ƒé˜Ÿåˆ—æ ‡ç­¾é¡µï¼š
- ä»»åŠ¡åˆ—è¡¨ (QTableView/QTreeView)
- åˆ—ï¼šçŠ¶æ€å›¾æ ‡ã€äº§å“ç¼–ç ã€äº§å“åã€æ¸ é“ã€ç¾¤åã€æ’æœŸæ—¶é—´ã€æ“ä½œ
- æ”¯æŒæ‹–æ‹½æ’åº
- å³é”®èœå•ï¼šç«‹å³æ‰§è¡Œã€ç¼–è¾‘æ’æœŸã€å–æ¶ˆã€åˆ é™¤
- å·¥å…·æ ï¼šå¯¼å…¥Excelã€å¼€å§‹å‘å¸ƒã€æš‚åœã€å…¨é€‰ã€ç­›é€‰
- ä»»åŠ¡çŠ¶æ€å®æ—¶æ›´æ–°

## 3. gui/styles.py
ç»Ÿä¸€æ ·å¼å®šä¹‰ï¼š
- çŠ¶æ€å›¾æ ‡å’Œé¢œè‰²æ˜ å°„
- æŒ‰é’®æ ·å¼
- è¡¨æ ¼æ ·å¼
- æ·±è‰²/æµ…è‰²ä¸»é¢˜ (å¯é€‰)

# å…³é”®çº¦æŸ
1. ä½¿ç”¨ PySide6 (ä¸æ˜¯ PyQt)
2. ä»»åŠ¡åˆ—è¡¨ä½¿ç”¨ Model-View æ¨¡å¼
3. çŠ¶æ€æ›´æ–°ä½¿ç”¨ä¿¡å·æ§½æœºåˆ¶
4. UI çº¿ç¨‹ä¸æ‰§è¡Œè€—æ—¶æ“ä½œ

# è¾“å‡ºè¦æ±‚
- å®Œæ•´çš„ä¸»çª—å£å’Œé˜Ÿåˆ—æ ‡ç­¾é¡µ
- ç¾è§‚çš„ç°ä»£ UI é£æ ¼
```

---

### çº¿ç¨‹ 5-B: å®šæ—¶è®¾ç½®ä¸ç³»ç»Ÿè®¾ç½®

```
# è§’è‰²
ä½ æ˜¯ä¸€ä¸ª PySide6 GUI å¼€å‘ä¸“å®¶ï¼Œè´Ÿè´£å®šæ—¶è®¾ç½®å’Œç³»ç»Ÿè®¾ç½®é¡µé¢ã€‚

# ä½ çš„ä»»åŠ¡
å¼€å‘å®šæ—¶è®¾ç½®å’Œç³»ç»Ÿè®¾ç½®æ ‡ç­¾é¡µã€‚

# éœ€è¦åˆ›å»ºçš„æ–‡ä»¶

## 1. gui/schedule_tab.py
å®šæ—¶è®¾ç½®æ ‡ç­¾é¡µï¼š
- æ—¥å†è§†å›¾æ˜¾ç¤ºå·²æ’æœŸä»»åŠ¡
- æ—¶é—´çº¿è§†å›¾ (ä»Šæ—¥ä»»åŠ¡ç”˜ç‰¹å›¾)
- æ‰¹é‡æ’æœŸåŠŸèƒ½
- æ’æœŸå†²çªæ£€æµ‹
- å¿«æ·æ“ä½œï¼šå‡åŒ€åˆ†å¸ƒã€æ¸…ç©ºæ’æœŸ

## 2. gui/settings_tab.py
ç³»ç»Ÿè®¾ç½®æ ‡ç­¾é¡µï¼š
åˆ†ç»„ï¼š
- è·¯å¾„è®¾ç½®ï¼šå…±äº«æ–‡ä»¶å¤¹ã€ç¼“å­˜ç›®å½•
- å‘å¸ƒè®¾ç½®ï¼šé»˜è®¤é—´éš”ã€æ¯æ—¥é™é¢ã€éšæœºå»¶è¿Ÿ
- é‚®ä»¶é€šçŸ¥ï¼šSMTPé…ç½®ã€æ”¶ä»¶äºº
- ç†”æ–­è®¾ç½®ï¼šå¤±è´¥é˜ˆå€¼ã€å†·å´æ—¶é—´
- æ˜¾ç¤ºè®¾ç½®ï¼šä¸»æ˜¾ç¤ºå™¨ä¼˜å…ˆ
- é«˜çº§è®¾ç½®ï¼šæ—¥å¿—çº§åˆ«ã€è°ƒè¯•æ¨¡å¼

åŠŸèƒ½ï¼š
- é…ç½®ä¿å­˜å’ŒåŠ è½½
- æ•æ„Ÿä¿¡æ¯è„±æ•æ˜¾ç¤º
- é…ç½®éªŒè¯
- æ¢å¤é»˜è®¤å€¼

# å…³é”®çº¦æŸ
1. è®¾ç½®å˜æ›´å³æ—¶ä¿å­˜
2. é‚®ç®±å¯†ç åŠ å¯†å­˜å‚¨
3. è·¯å¾„è®¾ç½®éœ€è¦éªŒè¯å¯è®¿é—®æ€§

# è¾“å‡ºè¦æ±‚
- å®Œæ•´çš„ä¸¤ä¸ªæ ‡ç­¾é¡µ
- è¡¨å•éªŒè¯å’Œé”™è¯¯æç¤º
```

---

### çº¿ç¨‹ 5-C: ç»Ÿè®¡ã€é¢„è§ˆä¸æ—¥å¿—

```
# è§’è‰²
ä½ æ˜¯ä¸€ä¸ª PySide6 GUI å¼€å‘ä¸“å®¶ï¼Œè´Ÿè´£ç»Ÿè®¡é¡µé¢å’Œå…¶ä»–å¯¹è¯æ¡†ã€‚

# ä½ çš„ä»»åŠ¡
å¼€å‘ç»Ÿè®¡æ ‡ç­¾é¡µã€é¢„è§ˆå¯¹è¯æ¡†å’Œæ—¥å¿—é¢æ¿ã€‚

# éœ€è¦åˆ›å»ºçš„æ–‡ä»¶

## 1. gui/stats_tab.py
æ•°æ®ç»Ÿè®¡æ ‡ç­¾é¡µï¼š
- ä»Šæ—¥ç»Ÿè®¡å¡ç‰‡ï¼šæ€»æ•°ã€æˆåŠŸã€å¤±è´¥ã€å¾…å‘
- å›¾è¡¨ï¼šè¿‘7å¤©è¶‹åŠ¿æŠ˜çº¿å›¾ã€æ¸ é“åˆ†å¸ƒé¥¼å›¾
- å†å²è®°å½•è¡¨æ ¼
- å¯¼å‡ºæŠ¥è¡¨æŒ‰é’®

## 2. gui/preview_dialog.py
å‘å¸ƒé¢„è§ˆå¯¹è¯æ¡†ï¼š
- æ˜¾ç¤ºå¾…å‘å¸ƒçš„æ–‡æ¡ˆå†…å®¹
- å›¾ç‰‡é¢„è§ˆ (ç¼©ç•¥å›¾åˆ—è¡¨)
- ç›®æ ‡æ¸ é“å’Œç¾¤å
- é¢„è®¡å‘å¸ƒæ—¶é—´
- ç¡®è®¤/å–æ¶ˆæŒ‰é’®

## 3. gui/log_panel.py
å®æ—¶æ—¥å¿—é¢æ¿ï¼š
- å¯åœé çš„é¢æ¿ (QDockWidget)
- æ—¥å¿—çº§åˆ«è¿‡æ»¤
- è‡ªåŠ¨æ»šåŠ¨åˆ°åº•éƒ¨
- å…³é”®è¯é«˜äº®
- å¯¼å‡ºæ—¥å¿—æŒ‰é’®

# å…³é”®çº¦æŸ
1. å›¾è¡¨ä½¿ç”¨ matplotlib æˆ– pyqtgraph
2. æ—¥å¿—é¢æ¿æ€§èƒ½ä¼˜åŒ– (å¤§é‡æ—¥å¿—æ—¶)
3. é¢„è§ˆå›¾ç‰‡ä½¿ç”¨ç¼©ç•¥å›¾

# è¾“å‡ºè¦æ±‚
- å®Œæ•´çš„ä¸‰ä¸ªç»„ä»¶
- æ•°æ®å¯è§†åŒ–å›¾è¡¨
```

</details>

---

### ç¬¬å…­é˜¶æ®µï¼šé€šçŸ¥ä¸æœåŠ¡ (2ä¸ªå¹¶è¡Œçº¿ç¨‹)

---

### çº¿ç¨‹ 6-A: é€šçŸ¥ç³»ç»Ÿ

```
# è§’è‰²
ä½ æ˜¯ä¸€ä¸ªé€šçŸ¥ç³»ç»Ÿå¼€å‘ä¸“å®¶ã€‚

# ä½ çš„ä»»åŠ¡
å¼€å‘é‚®ä»¶é€šçŸ¥å’Œç»Ÿä¸€é€šçŸ¥ç®¡ç†ã€‚

# éœ€è¦åˆ›å»ºçš„æ–‡ä»¶

## 1. services/email_notifier.py
é‚®ä»¶é€šçŸ¥å™¨ï¼š
- SMTP å‘é€é‚®ä»¶
- æ”¯æŒ HTML æ ¼å¼
- é‚®ä»¶æ¨¡æ¿ï¼šæ—¥æŠ¥ã€å‘Šè­¦ã€ç†”æ–­é€šçŸ¥
- é™„ä»¶æ”¯æŒ (å›æ‰§æ–‡ä»¶)
- å‘é€å¤±è´¥é‡è¯•

## 2. services/voice_notifier.py (å¯é€‰)
è¯­éŸ³é€šçŸ¥å™¨ï¼š
- ä½¿ç”¨ Windows TTS
- å…³é”®äº‹ä»¶è¯­éŸ³æ’­æŠ¥

## 3. services/notification_manager.py
é€šçŸ¥ç®¡ç†å™¨ï¼š
- ç»Ÿä¸€è°ƒåº¦å„ç±»é€šçŸ¥
- é€šçŸ¥å»é‡ (åŒä¸€äº‹ä»¶ä¸é‡å¤é€šçŸ¥)
- é€šçŸ¥é˜Ÿåˆ—
- æ ¹æ®é…ç½®å¯ç”¨/ç¦ç”¨é€šçŸ¥æ¸ é“

# è¾“å‡ºè¦æ±‚
- å®Œæ•´çš„é€šçŸ¥ç³»ç»Ÿ
- é‚®ä»¶æ¨¡æ¿ç¾è§‚
```

---

### çº¿ç¨‹ 6-B: ç»Ÿè®¡ä¸å›æ‰§

```
# è§’è‰²
ä½ æ˜¯ä¸€ä¸ªæ•°æ®æœåŠ¡å¼€å‘ä¸“å®¶ã€‚

# ä½ çš„ä»»åŠ¡
å¼€å‘ç»Ÿè®¡æœåŠ¡å’Œå›æ‰§ç”Ÿæˆã€‚

# éœ€è¦åˆ›å»ºçš„æ–‡ä»¶

## 1. services/stats_service.py
ç»Ÿè®¡æœåŠ¡ï¼š
- æ—¥ç»Ÿè®¡ï¼šæˆåŠŸæ•°ã€å¤±è´¥æ•°ã€è·³è¿‡æ•°
- å‘¨ç»Ÿè®¡èšåˆ
- æŒ‰æ¸ é“ç»Ÿè®¡
- æŒ‰ç¾¤ç»Ÿè®¡
- è¶‹åŠ¿æ•°æ®

## 2. data/receipt_generator.py
å›æ‰§ç”Ÿæˆå™¨ï¼š
- ç”Ÿæˆ Excel å›æ‰§æ–‡ä»¶
- æ–‡ä»¶åæ ¼å¼ï¼šreceipt_2024-11-25_220015.xlsx
- åŒ…å«ï¼šä»»åŠ¡è¯¦æƒ…ã€æ‰§è¡Œæ—¶é—´ã€çŠ¶æ€ã€é”™è¯¯ä¿¡æ¯
- åŒæ­¥å›å…±äº«æ–‡ä»¶å¤¹

## 3. services/time_service.py
æ—¶é—´æœåŠ¡ï¼š
- ç»Ÿä¸€æ—¶åŒºå¤„ç† (Asia/Shanghai)
- æ—¶é—´æ ¼å¼åŒ–
- æ—¶é—´æ¯”è¾ƒ

# è¾“å‡ºè¦æ±‚
- å®Œæ•´çš„æœåŠ¡å±‚å®ç°
```

---

## å…­ã€ç›®å½•ç»“æ„å‚è€ƒ

```
wechat-auto-sender/
â”œâ”€â”€ main.py                    # ä¸»ç¨‹åºå…¥å£
â”œâ”€â”€ config.yaml                # é…ç½®æ–‡ä»¶
â”œâ”€â”€ selectors.yaml             # UI é€‰æ‹©å™¨é…ç½®
â”œâ”€â”€ requirements.txt           # ä¾èµ–æ¸…å•
â”œâ”€â”€ DEVELOPMENT_PLAN.md        # æœ¬æ–‡ä»¶
â”‚
â”œâ”€â”€ gui/                       # UI å±‚
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ main_window.py         # ä¸»çª—å£
â”‚   â”œâ”€â”€ queue_tab.py           # å‘å¸ƒé˜Ÿåˆ—æ ‡ç­¾é¡µ
â”‚   â”œâ”€â”€ schedule_tab.py        # å®šæ—¶è®¾ç½®æ ‡ç­¾é¡µ
â”‚   â”œâ”€â”€ stats_tab.py           # æ•°æ®ç»Ÿè®¡æ ‡ç­¾é¡µ
â”‚   â”œâ”€â”€ settings_tab.py        # ç³»ç»Ÿè®¾ç½®æ ‡ç­¾é¡µ
â”‚   â”œâ”€â”€ preview_dialog.py      # å‘å¸ƒé¢„è§ˆå¼¹çª—
â”‚   â”œâ”€â”€ log_panel.py           # å®æ—¶æ—¥å¿—é¢æ¿
â”‚   â””â”€â”€ styles.py              # æ ·å¼å®šä¹‰
â”‚
â”œâ”€â”€ core/                      # æ‰§è¡Œå™¨å±‚
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ wechat_controller.py   # å¾®ä¿¡çª—å£æ§åˆ¶
â”‚   â”œâ”€â”€ moment_sender.py       # æœ‹å‹åœˆå‘å¸ƒå™¨
â”‚   â”œâ”€â”€ group_sender.py        # ç¾¤å‘æ¶ˆæ¯å™¨
â”‚   â”œâ”€â”€ element_locator.py     # å…ƒç´ å®šä½
â”‚   â”œâ”€â”€ popup_detector.py      # å¼¹çª—æ£€æµ‹
â”‚   â”œâ”€â”€ risk_detector.py       # é£æ§æ£€æµ‹
â”‚   â”œâ”€â”€ shutdown_controller.py # åœæœºæ§åˆ¶
â”‚   â”œâ”€â”€ clipboard_manager.py   # å‰ªè´´æ¿ç®¡ç†
â”‚   â”œâ”€â”€ display_manager.py     # æ˜¾ç¤ºå™¨ç®¡ç†
â”‚   â”œâ”€â”€ process_guardian.py    # è¿›ç¨‹å®ˆæŠ¤
â”‚   â””â”€â”€ env_checker.py         # ç¯å¢ƒè‡ªæ£€
â”‚
â”œâ”€â”€ data/                      # æ•°æ®å±‚
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ database.py            # SQLite æ•°æ®åº“æ“ä½œ
â”‚   â”œâ”€â”€ data_source.py         # ç»Ÿä¸€æ•°æ®æºæ¥å£
â”‚   â”œâ”€â”€ excel_parser.py        # Excel è§£æ
â”‚   â”œâ”€â”€ path_mapper.py         # è·¯å¾„æ˜ å°„
â”‚   â”œâ”€â”€ image_loader.py        # å›¾ç‰‡åŠ è½½
â”‚   â”œâ”€â”€ image_validator.py     # å›¾ç‰‡æ ¡éªŒ
â”‚   â””â”€â”€ receipt_generator.py   # å›æ‰§ç”Ÿæˆ
â”‚
â”œâ”€â”€ scheduler/                 # è°ƒåº¦å±‚
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ task_scheduler.py      # å®šæ—¶ä»»åŠ¡è°ƒåº¦
â”‚   â”œâ”€â”€ queue_manager.py       # ä»»åŠ¡é˜Ÿåˆ—ç®¡ç†
â”‚   â”œâ”€â”€ idempotency_manager.py # å¹‚ç­‰æ€§ç®¡ç†
â”‚   â”œâ”€â”€ retry_handler.py       # é‡è¯•é€»è¾‘
â”‚   â”œâ”€â”€ circuit_breaker.py     # ç†”æ–­å™¨
â”‚   â””â”€â”€ rate_limiter.py        # é€Ÿç‡é™åˆ¶å™¨
â”‚
â”œâ”€â”€ models/                    # æ•°æ®æ¨¡å‹
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ enums.py               # æšä¸¾å®šä¹‰
â”‚   â”œâ”€â”€ task.py                # ä»»åŠ¡æ¨¡å‹
â”‚   â”œâ”€â”€ content.py             # å†…å®¹æ¨¡å‹
â”‚   â””â”€â”€ stats.py               # ç»Ÿè®¡æ¨¡å‹
â”‚
â”œâ”€â”€ services/                  # æœåŠ¡å±‚
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ config_manager.py      # é…ç½®ç®¡ç†
â”‚   â”œâ”€â”€ email_notifier.py      # é‚®ä»¶é€šçŸ¥
â”‚   â”œâ”€â”€ voice_notifier.py      # è¯­éŸ³é€šçŸ¥
â”‚   â”œâ”€â”€ notification_manager.py# é€šçŸ¥ç®¡ç†å™¨
â”‚   â”œâ”€â”€ stats_service.py       # ç»Ÿè®¡æœåŠ¡
â”‚   â””â”€â”€ time_service.py        # æ—¶é—´æœåŠ¡
â”‚
â”œâ”€â”€ templates/                 # UI æˆªå›¾æ¨¡æ¿
â”‚   â””â”€â”€ v3.9.x/
â”‚
â”œâ”€â”€ logs/                      # æ—¥å¿—
â”œâ”€â”€ cache/                     # æœ¬åœ°ç¼“å­˜
â”œâ”€â”€ receipts/                  # å›æ‰§æ–‡ä»¶
â””â”€â”€ db/                        # SQLite æ•°æ®åº“
    â””â”€â”€ tasks.db
```

---

## ä¸ƒã€å¿«é€Ÿå¯åŠ¨

### å»ºè®®ç«‹å³å¯åŠ¨ç¬¬ä¸€é˜¶æ®µçš„ 3 ä¸ªçº¿ç¨‹ï¼š

1. **çº¿ç¨‹ 1-A**: æ•°æ®æ¨¡å‹å±‚ â†’ å¤åˆ¶å¯¹åº”æç¤ºè¯åˆ°æ–° Claude ä¼šè¯
2. **çº¿ç¨‹ 1-B**: é…ç½®ç³»ç»Ÿ â†’ å¤åˆ¶å¯¹åº”æç¤ºè¯åˆ°æ–° Claude ä¼šè¯
3. **çº¿ç¨‹ 1-C**: é¡¹ç›®éª¨æ¶ â†’ å¤åˆ¶å¯¹åº”æç¤ºè¯åˆ°æ–° Claude ä¼šè¯

### å®Œæˆåçš„ä¸‹ä¸€æ­¥

1. æ”¶é›†ä¸‰ä¸ªçº¿ç¨‹çš„è¾“å‡ºä»£ç 
2. åˆå¹¶åˆ°é¡¹ç›®ç›®å½•
3. è¿è¡Œ `pip install -r requirements.txt`
4. éªŒè¯åŸºç¡€æ¡†æ¶å¯è¿è¡Œ
5. å¯åŠ¨ç¬¬äºŒé˜¶æ®µçš„ 4 ä¸ªå¹¶è¡Œçº¿ç¨‹

---

> æœ¬æ–‡æ¡£ç”± Claude ç”Ÿæˆï¼Œä½œä¸ºé¡¹ç›®å¼€å‘çš„æ€»ä½“è§„åˆ’æŒ‡å—ã€‚

---

## å…«ã€æŠ€æœ¯æ–¹æ¡ˆè®°å½•

### 8.1 æœ‹å‹åœˆè¯¦æƒ…é¡µ "..." æŒ‰é’®å®šä½æ–¹æ¡ˆ

> æ›´æ–°æ—¶é—´: 2025-12-05
> é—®é¢˜: æœ‹å‹åœˆè¯¦æƒ…é¡µçš„ "..." æŒ‰é’® Y åæ ‡éšå†…å®¹é•¿åº¦å˜åŒ–ï¼Œå›ºå®šåæ ‡æ— æ³•é€‚åº”

#### é—®é¢˜åˆ†æ

1. "..." æŒ‰é’®åœ¨æœ‹å‹åœˆè¯¦æƒ…é¡µä¸­ï¼Œä½äºæ—¶é—´æˆ³å³è¾¹
2. æŒ‰é’®çš„ Y åæ ‡éšæœ‹å‹åœˆå†…å®¹é•¿åº¦ï¼ˆæ–‡å­—ã€å›¾ç‰‡æ•°é‡ï¼‰å˜åŒ–
3. UI è‡ªåŠ¨åŒ–æ— æ³•è¯†åˆ«è¯¥æŒ‰é’®ï¼ˆè‡ªç»˜æ§ä»¶ï¼‰
4. ç›´æ¥å›¾åƒè¯†åˆ« "..." æŒ‰é’®å®¹æ˜“è¯¯åŒ¹é…åˆ°å›¾ç‰‡åŒºåŸŸ

#### è§£å†³æ–¹æ¡ˆ: åˆ é™¤æŒ‰é’®å®šä½æ³•

**æ ¸å¿ƒæ€è·¯**: åˆ é™¤æŒ‰é’®ï¼ˆåƒåœ¾æ¡¶å›¾æ ‡ï¼‰å’Œ "..." æŒ‰é’®åœ¨åŒä¸€è¡Œï¼Œé€šè¿‡è¯†åˆ«åˆ é™¤æŒ‰é’®è·å– Y åæ ‡ï¼Œç»“åˆå›ºå®šçš„ X åæ ‡å®šä½ "..."

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æœ‹å‹åœˆè¯¦æƒ…é¡µ                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  å†…å®¹åŒºåŸŸï¼ˆé•¿åº¦å¯å˜ï¼‰              â”‚   â”‚
â”‚  â”‚  ...                             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                         â”‚
â”‚  21:08  ğŸ—‘ï¸                         Â·Â·Â· â”‚
â”‚         â†‘                           â†‘   â”‚
â”‚    åˆ é™¤æŒ‰é’®                      "..."  â”‚
â”‚    (å›¾åƒè¯†åˆ«)               (å›ºå®šXåæ ‡)  â”‚
â”‚         â””â”€â”€ è·å– Y åæ ‡ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### å®ç°ä»£ç 

**æ–‡ä»¶**: `core/moment_sender.py`

**æ–°å¢æ–¹æ³•**: `_find_dots_by_delete_btn()` (ç¬¬ 1560-1599 è¡Œ)

```python
def _find_dots_by_delete_btn(self) -> Optional[tuple]:
    """
    é€šè¿‡è¯†åˆ«åˆ é™¤æŒ‰é’®ï¼ˆåƒåœ¾æ¡¶ï¼‰æ¥å®šä½ "..." æŒ‰é’®

    åŸç†ï¼šåˆ é™¤æŒ‰é’®å’Œ "..." æŒ‰é’®åœ¨åŒä¸€è¡Œ
    - æ‰¾åˆ°åˆ é™¤æŒ‰é’®è·å– Y åæ ‡
    - "..." æŒ‰é’®çš„ X åæ ‡å›ºå®šï¼ˆè·çª—å£å³è¾¹ 55pxï¼‰
    """
    # ç”¨å›¾åƒè¯†åˆ«æ‰¾åˆ é™¤æŒ‰é’®
    template_path = self.TEMPLATE_DIR / "delete_btn.png"

    for confidence in [0.8, 0.7, 0.6, 0.5]:
        location = pyautogui.locateOnScreen(str(template_path), confidence=confidence)
        if location:
            center = pyautogui.center(location)
            # "..." X åæ ‡å›ºå®šï¼ŒY åæ ‡å’Œåˆ é™¤æŒ‰é’®ç›¸åŒ
            dots_x = rect.right - 55  # é…ç½®é¡¹: dots_btn_right_offset
            dots_y = center.y
            return (dots_x, dots_y)

    return None
```

**æ··åˆå®šä½ä¼˜å…ˆçº§**: `_find_dots_button_hybrid()` (ç¬¬ 1661-1691 è¡Œ)

```
1. åˆ é™¤æŒ‰é’®å®šä½ï¼ˆæœ€å¯é ï¼Œé€‚åº”å†…å®¹é•¿åº¦å˜åŒ–ï¼‰
2. æ—¶é—´æˆ³ç›¸å¯¹å®šä½ï¼ˆå¤‡é€‰ï¼‰
3. åæ ‡åå¤‡ï¼ˆæœ€åæ‰‹æ®µï¼‰
```

#### é…ç½®é¡¹

**æ–‡ä»¶**: `config.yaml`

```yaml
ui_location:
  dots_btn_right_offset: 55    # "..." è·çª—å£å³è¾¹çš„åƒç´ 
  dots_btn_top_offset: 864     # åæ ‡åå¤‡çš„ Y åç§»
```

#### æ¨¡æ¿å›¾ç‰‡

**æ–‡ä»¶**: `data/templates/delete_btn.png`

- å†…å®¹: è“è‰²åƒåœ¾æ¡¶å›¾æ ‡
- è¯†åˆ«ç½®ä¿¡åº¦: 0.7 æœ€ä½³

#### æµ‹è¯•ç»“æœ

- çŸ­å†…å®¹æœ‹å‹åœˆ: æˆåŠŸå®šä½
- é•¿å†…å®¹æœ‹å‹åœˆ: æˆåŠŸå®šä½
- å¤šå›¾æœ‹å‹åœˆ: æˆåŠŸå®šä½
